; generated by Component: ARM Compiler 5.05 update 2 (build 169) Tool: ArmCC [4d0f38]
; commandline ArmCC [--list --debug -c --asm --interleave -o.\obj\menu.o --asm_dir=.\list\ --list_dir=.\list\ --depend=.\obj\menu.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931 -I.\FWlib\inc -I.\user -I.\CM3 -I.\TFT -I.\GUI\AntiAlias -I.\GUI\Config -I.\GUI\ConvertColor -I.\GUI\ConvertMono -I.\GUI\Core -I.\GUI\Font -I.\GUI\GUI_X -I.\GUI\JPEG -I.\GUI\LCDDriver -I.\GUI\MemDev -I.\GUI\MultiLayer -I.\GUI\Widget -I.\GUI\WM -IC:\Users\Administrator\Desktop\gui\STM32·Ü¶·°å-3.98\RTE -Id:\Keil_v5\ARM\PACK\ARM\CMSIS\4.3.0\CMSIS\Include -Id:\Keil_v5\ARM\PACK\Keil\STM32F1xx_DFP\1.1.0\Device\Include -D__UVISION_VERSION=515 -D_RTE_ -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER -DSTM32F10X_HD -DUSE_STM3210B_EVAL --omf_browse=.\obj\menu.crf GUI\Widget\MENU.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  MENU__SendMenuMessage PROC
;;;1338   */
;;;1339   int MENU__SendMenuMessage(MENU_Handle hObj, WM_HWIN hDestWin, U16 MsgType, U16 ItemId) {
000000  e92d41ff          PUSH     {r0-r8,lr}
000004  4605              MOV      r5,r0
000006  460c              MOV      r4,r1
000008  4616              MOV      r6,r2
00000a  461f              MOV      r7,r3
;;;1340     MENU_MSG_DATA MsgData;
;;;1341     WM_MESSAGE    Msg = {0};
00000c  2000              MOVS     r0,#0
00000e  9000              STR      r0,[sp,#0]
000010  9001              STR      r0,[sp,#4]
000012  9002              STR      r0,[sp,#8]
;;;1342     MsgData.MsgType   = MsgType;
000014  f8ad600c          STRH     r6,[sp,#0xc]
;;;1343     MsgData.ItemId    = ItemId;
000018  f8ad700e          STRH     r7,[sp,#0xe]
;;;1344     Msg.MsgId         = WM_MENU;
00001c  202c              MOVS     r0,#0x2c
00001e  9000              STR      r0,[sp,#0]
;;;1345     Msg.Data.p        = &MsgData;
000020  a803              ADD      r0,sp,#0xc
000022  9002              STR      r0,[sp,#8]
;;;1346     Msg.hWinSrc       = hObj;
000024  f8ad5006          STRH     r5,[sp,#6]
;;;1347     if (!hDestWin) {
000028  b91c              CBNZ     r4,|L1.50|
;;;1348       hDestWin = WM_GetParent(hObj);
00002a  4628              MOV      r0,r5
00002c  f7fffffe          BL       WM_GetParent
000030  4604              MOV      r4,r0
                  |L1.50|
;;;1349     }
;;;1350     if (hDestWin) {
000032  b13c              CBZ      r4,|L1.68|
;;;1351       WM__SendMessage(hDestWin, &Msg);
000034  4669              MOV      r1,sp
000036  4620              MOV      r0,r4
000038  f7fffffe          BL       WM__SendMessage
;;;1352       return Msg.Data.v;
00003c  9802              LDR      r0,[sp,#8]
                  |L1.62|
;;;1353     }
;;;1354     return 0;
;;;1355   }
00003e  b004              ADD      sp,sp,#0x10
000040  e8bd81f0          POP      {r4-r8,pc}
                  |L1.68|
000044  2000              MOVS     r0,#0                 ;1354
000046  e7fa              B        |L1.62|
;;;1356   
                          ENDP

                  _IsTopLevelMenu PROC
;;;153    */
;;;154    static char _IsTopLevelMenu(MENU_Handle hObj, const MENU_Obj* pObj) {
000048  b570              PUSH     {r4-r6,lr}
00004a  4605              MOV      r5,r0
00004c  460c              MOV      r4,r1
;;;155      if (MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_IS_MENU, 0) == 0) {
00004e  f9b4105c          LDRSH    r1,[r4,#0x5c]
000052  2300              MOVS     r3,#0
000054  2205              MOVS     r2,#5
000056  4628              MOV      r0,r5
000058  f7fffffe          BL       MENU__SendMenuMessage
00005c  b908              CBNZ     r0,|L1.98|
;;;156        return 1;
00005e  2001              MOVS     r0,#1
                  |L1.96|
;;;157      }
;;;158      return 0;
;;;159    }
000060  bd70              POP      {r4-r6,pc}
                  |L1.98|
000062  2000              MOVS     r0,#0                 ;158
000064  e7fc              B        |L1.96|
;;;160    
                          ENDP

                  _GetTopLevelMenu PROC
;;;173    */
;;;174    static void _GetTopLevelMenu(MENU_Handle hObj, MENU_Obj * pObj, MENU_Handle * phObjTopLevel, MENU_Obj ** ppObjTopLevel, int * pSubSel) {
000066  e92d47f0          PUSH     {r4-r10,lr}
00006a  4682              MOV      r10,r0
00006c  460e              MOV      r6,r1
00006e  4617              MOV      r7,r2
000070  4698              MOV      r8,r3
000072  f8dd9020          LDR      r9,[sp,#0x20]
;;;175      MENU_Handle hObjTopLevel;
;;;176      MENU_Obj * pObjTopLevel;
;;;177      pObjTopLevel = pObj;
000076  4635              MOV      r5,r6
;;;178      if (_IsTopLevelMenu(hObj, pObj)) {
000078  4631              MOV      r1,r6
00007a  4650              MOV      r0,r10
00007c  f7fffffe          BL       _IsTopLevelMenu
000080  b110              CBZ      r0,|L1.136|
;;;179        hObjTopLevel = hObj;
000082  4654              MOV      r4,r10
;;;180        pObjTopLevel = pObj;
000084  4635              MOV      r5,r6
000086  e014              B        |L1.178|
                  |L1.136|
;;;181      } else {
;;;182        do {
000088  bf00              NOP      
                  |L1.138|
;;;183          hObjTopLevel = pObjTopLevel->hOwner;
00008a  f9b5405c          LDRSH    r4,[r5,#0x5c]
;;;184          pObjTopLevel = (MENU_Obj *)GUI_ALLOC_h2p(hObjTopLevel);
00008e  4620              MOV      r0,r4
000090  f7fffffe          BL       GUI_ALLOC_h2p
000094  4605              MOV      r5,r0
;;;185          if (_IsTopLevelMenu(hObjTopLevel, pObjTopLevel)) {
000096  4629              MOV      r1,r5
000098  4620              MOV      r0,r4
00009a  f7fffffe          BL       _IsTopLevelMenu
00009e  b100              CBZ      r0,|L1.162|
;;;186            break;
0000a0  e006              B        |L1.176|
                  |L1.162|
;;;187          } else {
;;;188            if (pSubSel) {
0000a2  f1b90f00          CMP      r9,#0
0000a6  d002              BEQ      |L1.174|
;;;189              *pSubSel = pObjTopLevel->Sel;
0000a8  6ee8              LDR      r0,[r5,#0x6c]
0000aa  f8c90000          STR      r0,[r9,#0]
                  |L1.174|
;;;190            }
;;;191          }
;;;192        } while (1);
0000ae  e7ec              B        |L1.138|
                  |L1.176|
0000b0  bf00              NOP                            ;186
                  |L1.178|
;;;193      }
;;;194      *phObjTopLevel = hObjTopLevel;
0000b2  803c              STRH     r4,[r7,#0]
;;;195      *ppObjTopLevel = pObjTopLevel;
0000b4  f8c85000          STR      r5,[r8,#0]
;;;196    }
0000b8  e8bd87f0          POP      {r4-r10,pc}
;;;197    
                          ENDP

                  _HasEffect PROC
;;;201    */
;;;202    static int _HasEffect(MENU_Handle hObj, MENU_Obj* pObj) {
0000bc  b570              PUSH     {r4-r6,lr}
0000be  4605              MOV      r5,r0
0000c0  460c              MOV      r4,r1
;;;203      if (!(pObj->Flags & MENU_SF_POPUP)) {
0000c2  f894005e          LDRB     r0,[r4,#0x5e]
0000c6  f0000080          AND      r0,r0,#0x80
0000ca  b930              CBNZ     r0,|L1.218|
;;;204        if (_IsTopLevelMenu(hObj, pObj)) {
0000cc  4621              MOV      r1,r4
0000ce  4628              MOV      r0,r5
0000d0  f7fffffe          BL       _IsTopLevelMenu
0000d4  b108              CBZ      r0,|L1.218|
;;;205          return 0;
0000d6  2000              MOVS     r0,#0
                  |L1.216|
;;;206        }
;;;207      }
;;;208      return 1;
;;;209    }
0000d8  bd70              POP      {r4-r6,pc}
                  |L1.218|
0000da  2001              MOVS     r0,#1                 ;208
0000dc  e7fc              B        |L1.216|
;;;210    
                          ENDP

                  _GetEffectSize PROC
;;;214    */
;;;215    static int _GetEffectSize(MENU_Handle hObj, MENU_Obj* pObj) {
0000de  b570              PUSH     {r4-r6,lr}
0000e0  4605              MOV      r5,r0
0000e2  460c              MOV      r4,r1
;;;216      int r = 0;
0000e4  2600              MOVS     r6,#0
;;;217      if (_HasEffect(hObj, pObj)) { 
0000e6  4621              MOV      r1,r4
0000e8  4628              MOV      r0,r5
0000ea  f7fffffe          BL       _HasEffect
0000ee  b108              CBZ      r0,|L1.244|
;;;218        r = pObj->Widget.pEffect->EffectSize;
0000f0  6a20              LDR      r0,[r4,#0x20]
0000f2  6946              LDR      r6,[r0,#0x14]
                  |L1.244|
;;;219      }
;;;220      return r;
0000f4  4630              MOV      r0,r6
;;;221    }
0000f6  bd70              POP      {r4-r6,pc}
;;;222    
                          ENDP

                  _CalcTextWidth PROC
;;;226    */
;;;227    static int _CalcTextWidth(MENU_Obj* pObj, const char GUI_UNI_PTR* sText) {
0000f8  e92d41f0          PUSH     {r4-r8,lr}
0000fc  4605              MOV      r5,r0
0000fe  460c              MOV      r4,r1
;;;228      int TextWidth = 0;
000100  2600              MOVS     r6,#0
;;;229      if (sText) {
000102  b15c              CBZ      r4,|L1.284|
;;;230        const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;231        pOldFont  = GUI_SetFont(pObj->Props.pFont);
000104  6d68              LDR      r0,[r5,#0x54]
000106  f7fffffe          BL       GUI_SetFont
00010a  4607              MOV      r7,r0
;;;232        TextWidth = GUI_GetStringDistX(sText);
00010c  4620              MOV      r0,r4
00010e  f7fffffe          BL       GUI_GetStringDistX
000112  4606              MOV      r6,r0
;;;233        GUI_SetFont(pOldFont);
000114  4638              MOV      r0,r7
000116  f7fffffe          BL       GUI_SetFont
;;;234      }
00011a  bf00              NOP      
                  |L1.284|
;;;235      return TextWidth;
00011c  4630              MOV      r0,r6
;;;236    }
00011e  e8bd81f0          POP      {r4-r8,pc}
;;;237    
                          ENDP

                  _GetItemWidth PROC
;;;241    */
;;;242    static int _GetItemWidth(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000122  e92d41f0          PUSH     {r4-r8,lr}
000126  4680              MOV      r8,r0
000128  460c              MOV      r4,r1
00012a  4616              MOV      r6,r2
;;;243      int ItemWidth;
;;;244      if (pObj->Width && (pObj->Flags & MENU_SF_VERTICAL)) {
00012c  6e60              LDR      r0,[r4,#0x64]
00012e  b160              CBZ      r0,|L1.330|
000130  f894005e          LDRB     r0,[r4,#0x5e]
000134  f0000001          AND      r0,r0,#1
000138  b138              CBZ      r0,|L1.330|
;;;245        ItemWidth = pObj->Width - (_GetEffectSize(hObj, pObj) << 1);
00013a  4621              MOV      r1,r4
00013c  4640              MOV      r0,r8
00013e  f7fffffe          BL       _GetEffectSize
000142  6e61              LDR      r1,[r4,#0x64]
000144  eba10540          SUB      r5,r1,r0,LSL #1
000148  e018              B        |L1.380|
                  |L1.330|
;;;246      } else {
;;;247        MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00014a  4631              MOV      r1,r6
00014c  f1040058          ADD      r0,r4,#0x58
000150  f7fffffe          BL       GUI_ARRAY_GetpItem
000154  4607              MOV      r7,r0
;;;248        if ((pObj->Flags & MENU_SF_VERTICAL) || !(pItem->Flags & MENU_IF_SEPARATOR)) {
000156  f894005e          LDRB     r0,[r4,#0x5e]
00015a  f0000001          AND      r0,r0,#1
00015e  b918              CBNZ     r0,|L1.360|
000160  7938              LDRB     r0,[r7,#4]
000162  f0000002          AND      r0,r0,#2
000166  b908              CBNZ     r0,|L1.364|
                  |L1.360|
;;;249          ItemWidth = pItem->TextWidth;
000168  68bd              LDR      r5,[r7,#8]
00016a  e000              B        |L1.366|
                  |L1.364|
;;;250        } else {
;;;251          ItemWidth = 3;
00016c  2503              MOVS     r5,#3
                  |L1.366|
;;;252       }
;;;253        ItemWidth += pObj->Props.aBorder[MENU_BI_LEFT] + pObj->Props.aBorder[MENU_BI_RIGHT];
00016e  f8941050          LDRB     r1,[r4,#0x50]
000172  f8940051          LDRB     r0,[r4,#0x51]
000176  4408              ADD      r0,r0,r1
000178  4405              ADD      r5,r5,r0
;;;254      }
00017a  bf00              NOP      
                  |L1.380|
;;;255      return ItemWidth;
00017c  4628              MOV      r0,r5
;;;256    }
00017e  e8bd81f0          POP      {r4-r8,pc}
;;;257    
                          ENDP

                  _GetItemHeight PROC
;;;261    */
;;;262    static int _GetItemHeight(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000182  e92d41f0          PUSH     {r4-r8,lr}
000186  4607              MOV      r7,r0
000188  460c              MOV      r4,r1
00018a  4616              MOV      r6,r2
;;;263      int ItemHeight;
;;;264      if (pObj->Height && !(pObj->Flags & MENU_SF_VERTICAL)) {
00018c  6ea0              LDR      r0,[r4,#0x68]
00018e  b160              CBZ      r0,|L1.426|
000190  f894005e          LDRB     r0,[r4,#0x5e]
000194  f0000001          AND      r0,r0,#1
000198  b938              CBNZ     r0,|L1.426|
;;;265        ItemHeight = pObj->Height - (_GetEffectSize(hObj, pObj) << 1);
00019a  4621              MOV      r1,r4
00019c  4638              MOV      r0,r7
00019e  f7fffffe          BL       _GetEffectSize
0001a2  6ea1              LDR      r1,[r4,#0x68]
0001a4  eba10540          SUB      r5,r1,r0,LSL #1
0001a8  e01b              B        |L1.482|
                  |L1.426|
;;;266      } else {
;;;267        ItemHeight = GUI_GetYDistOfFont(pObj->Props.pFont);
0001aa  6d60              LDR      r0,[r4,#0x54]
0001ac  f7fffffe          BL       GUI_GetYDistOfFont
0001b0  4605              MOV      r5,r0
;;;268        if (pObj->Flags & MENU_SF_VERTICAL) {
0001b2  f894005e          LDRB     r0,[r4,#0x5e]
0001b6  f0000001          AND      r0,r0,#1
0001ba  b160              CBZ      r0,|L1.470|
;;;269          MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
0001bc  4631              MOV      r1,r6
0001be  f1040058          ADD      r0,r4,#0x58
0001c2  f7fffffe          BL       GUI_ARRAY_GetpItem
0001c6  4680              MOV      r8,r0
;;;270          if (pItem->Flags & MENU_IF_SEPARATOR) {
0001c8  f8980004          LDRB     r0,[r8,#4]
0001cc  f0000002          AND      r0,r0,#2
0001d0  b100              CBZ      r0,|L1.468|
;;;271            ItemHeight = 3;
0001d2  2503              MOVS     r5,#3
                  |L1.468|
;;;272          }
;;;273        }
0001d4  bf00              NOP      
                  |L1.470|
;;;274        ItemHeight += pObj->Props.aBorder[MENU_BI_TOP] + pObj->Props.aBorder[MENU_BI_BOTTOM];
0001d6  f8941052          LDRB     r1,[r4,#0x52]
0001da  f8940053          LDRB     r0,[r4,#0x53]
0001de  4408              ADD      r0,r0,r1
0001e0  4405              ADD      r5,r5,r0
                  |L1.482|
;;;275      }
;;;276      return ItemHeight;
0001e2  4628              MOV      r0,r5
;;;277    }
0001e4  e8bd81f0          POP      {r4-r8,pc}
;;;278    
                          ENDP

                  MENU__GetNumItems PROC
;;;1253   */
;;;1254   unsigned MENU__GetNumItems(MENU_Obj* pObj) {
0001e8  b510              PUSH     {r4,lr}
0001ea  4604              MOV      r4,r0
;;;1255     return GUI_ARRAY_GetNumItems(&pObj->ItemArray);
0001ec  f1040058          ADD      r0,r4,#0x58
0001f0  f7fffffe          BL       GUI_ARRAY_GetNumItems
;;;1256   }
0001f4  bd10              POP      {r4,pc}
;;;1257   
                          ENDP

                  _CalcMenuSizeX PROC
;;;282    */
;;;283    static int _CalcMenuSizeX(MENU_Handle hObj, MENU_Obj* pObj) {
0001f6  e92d47f0          PUSH     {r4-r10,lr}
0001fa  4681              MOV      r9,r0
0001fc  460f              MOV      r7,r1
;;;284      unsigned i, NumItems = MENU__GetNumItems(pObj);
0001fe  4638              MOV      r0,r7
000200  f7fffffe          BL       MENU__GetNumItems
000204  4680              MOV      r8,r0
;;;285      int xSize = 0;
000206  2500              MOVS     r5,#0
;;;286      if (pObj->Flags & MENU_SF_VERTICAL) {
000208  f897005e          LDRB     r0,[r7,#0x5e]
00020c  f0000001          AND      r0,r0,#1
000210  b170              CBZ      r0,|L1.560|
;;;287        int ItemWidth;
;;;288        for (i = 0; i < NumItems; i++) {
000212  2400              MOVS     r4,#0
000214  e009              B        |L1.554|
                  |L1.534|
;;;289          ItemWidth = _GetItemWidth(hObj, pObj, i);
000216  4622              MOV      r2,r4
000218  4639              MOV      r1,r7
00021a  4648              MOV      r0,r9
00021c  f7fffffe          BL       _GetItemWidth
000220  4606              MOV      r6,r0
;;;290          if (ItemWidth > xSize) {
000222  42ae              CMP      r6,r5
000224  dd00              BLE      |L1.552|
;;;291            xSize = ItemWidth;
000226  4635              MOV      r5,r6
                  |L1.552|
000228  1c64              ADDS     r4,r4,#1              ;288
                  |L1.554|
00022a  4544              CMP      r4,r8                 ;288
00022c  d3f3              BCC      |L1.534|
;;;292          }
;;;293        }
;;;294      } else {
00022e  e00a              B        |L1.582|
                  |L1.560|
;;;295        for (i = 0; i < NumItems; i++) {
000230  2400              MOVS     r4,#0
000232  e006              B        |L1.578|
                  |L1.564|
;;;296          xSize += _GetItemWidth(hObj, pObj, i);
000234  4622              MOV      r2,r4
000236  4639              MOV      r1,r7
000238  4648              MOV      r0,r9
00023a  f7fffffe          BL       _GetItemWidth
00023e  4405              ADD      r5,r5,r0
000240  1c64              ADDS     r4,r4,#1              ;295
                  |L1.578|
000242  4544              CMP      r4,r8                 ;295
000244  d3f6              BCC      |L1.564|
                  |L1.582|
;;;297        }
;;;298      }
;;;299      xSize += (_GetEffectSize(hObj, pObj) << 1);
000246  4639              MOV      r1,r7
000248  4648              MOV      r0,r9
00024a  f7fffffe          BL       _GetEffectSize
00024e  eb050540          ADD      r5,r5,r0,LSL #1
;;;300      return xSize;
000252  4628              MOV      r0,r5
;;;301    }
000254  e8bd87f0          POP      {r4-r10,pc}
;;;302    
                          ENDP

                  _CalcMenuSizeY PROC
;;;306    */
;;;307    static int _CalcMenuSizeY(MENU_Handle hObj, MENU_Obj* pObj) {
000258  e92d47f0          PUSH     {r4-r10,lr}
00025c  4681              MOV      r9,r0
00025e  460f              MOV      r7,r1
;;;308      unsigned i, NumItems = MENU__GetNumItems(pObj);
000260  4638              MOV      r0,r7
000262  f7fffffe          BL       MENU__GetNumItems
000266  4680              MOV      r8,r0
;;;309      int ySize = 0;
000268  2500              MOVS     r5,#0
;;;310      if (pObj->Flags & MENU_SF_VERTICAL) {
00026a  f897005e          LDRB     r0,[r7,#0x5e]
00026e  f0000001          AND      r0,r0,#1
000272  b158              CBZ      r0,|L1.652|
;;;311        for (i = 0; i < NumItems; i++) {
000274  2400              MOVS     r4,#0
000276  e006              B        |L1.646|
                  |L1.632|
;;;312          ySize += _GetItemHeight(hObj, pObj, i);
000278  4622              MOV      r2,r4
00027a  4639              MOV      r1,r7
00027c  4648              MOV      r0,r9
00027e  f7fffffe          BL       _GetItemHeight
000282  4405              ADD      r5,r5,r0
000284  1c64              ADDS     r4,r4,#1              ;311
                  |L1.646|
000286  4544              CMP      r4,r8                 ;311
000288  d3f6              BCC      |L1.632|
00028a  e00e              B        |L1.682|
                  |L1.652|
;;;313        }
;;;314      } else {
;;;315        int ItemHeight;
;;;316        for (i = 0; i < NumItems; i++) {
00028c  2400              MOVS     r4,#0
00028e  e009              B        |L1.676|
                  |L1.656|
;;;317          ItemHeight = _GetItemHeight(hObj, pObj, i);
000290  4622              MOV      r2,r4
000292  4639              MOV      r1,r7
000294  4648              MOV      r0,r9
000296  f7fffffe          BL       _GetItemHeight
00029a  4606              MOV      r6,r0
;;;318          if (ItemHeight > ySize) {
00029c  42ae              CMP      r6,r5
00029e  dd00              BLE      |L1.674|
;;;319            ySize = ItemHeight;
0002a0  4635              MOV      r5,r6
                  |L1.674|
0002a2  1c64              ADDS     r4,r4,#1              ;316
                  |L1.676|
0002a4  4544              CMP      r4,r8                 ;316
0002a6  d3f3              BCC      |L1.656|
;;;320          }
;;;321        }
;;;322      }
0002a8  bf00              NOP      
                  |L1.682|
;;;323      ySize += (_GetEffectSize(hObj, pObj) << 1);
0002aa  4639              MOV      r1,r7
0002ac  4648              MOV      r0,r9
0002ae  f7fffffe          BL       _GetEffectSize
0002b2  eb050540          ADD      r5,r5,r0,LSL #1
;;;324      return ySize;
0002b6  4628              MOV      r0,r5
;;;325    }
0002b8  e8bd87f0          POP      {r4-r10,pc}
;;;326    
                          ENDP

                  _CalcWindowSizeX PROC
;;;330    */
;;;331    static int _CalcWindowSizeX(MENU_Handle hObj, MENU_Obj* pObj) {
0002bc  b570              PUSH     {r4-r6,lr}
0002be  4606              MOV      r6,r0
0002c0  460c              MOV      r4,r1
;;;332      int xSize = pObj->Width;
0002c2  6e65              LDR      r5,[r4,#0x64]
;;;333      if (xSize == 0) {
0002c4  b925              CBNZ     r5,|L1.720|
;;;334        xSize = _CalcMenuSizeX(hObj, pObj);
0002c6  4621              MOV      r1,r4
0002c8  4630              MOV      r0,r6
0002ca  f7fffffe          BL       _CalcMenuSizeX
0002ce  4605              MOV      r5,r0
                  |L1.720|
;;;335      }
;;;336      return xSize;
0002d0  4628              MOV      r0,r5
;;;337    }
0002d2  bd70              POP      {r4-r6,pc}
;;;338    
                          ENDP

                  _CalcWindowSizeY PROC
;;;342    */
;;;343    static int _CalcWindowSizeY(MENU_Handle hObj, MENU_Obj* pObj) {
0002d4  b570              PUSH     {r4-r6,lr}
0002d6  4606              MOV      r6,r0
0002d8  460c              MOV      r4,r1
;;;344      int ySize = pObj->Height;
0002da  6ea5              LDR      r5,[r4,#0x68]
;;;345      if (ySize == 0) {
0002dc  b925              CBNZ     r5,|L1.744|
;;;346        ySize = _CalcMenuSizeY(hObj, pObj);
0002de  4621              MOV      r1,r4
0002e0  4630              MOV      r0,r6
0002e2  f7fffffe          BL       _CalcMenuSizeY
0002e6  4605              MOV      r5,r0
                  |L1.744|
;;;347      }
;;;348      return ySize;
0002e8  4628              MOV      r0,r5
;;;349    }
0002ea  bd70              POP      {r4-r6,pc}
;;;350    
                          ENDP

                  _GetItemFromPos PROC
;;;361    */
;;;362    static int _GetItemFromPos(MENU_Handle hObj, MENU_Obj* pObj, int x, int y) {
0002ec  e92d4fff          PUSH     {r0-r11,lr}
0002f0  b083              SUB      sp,sp,#0xc
0002f2  460c              MOV      r4,r1
0002f4  4617              MOV      r7,r2
0002f6  4698              MOV      r8,r3
;;;363      int xSize, ySize, EffectSize, r = -1;
0002f8  f04f30ff          MOV      r0,#0xffffffff
0002fc  9002              STR      r0,[sp,#8]
;;;364      ySize = _CalcMenuSizeY(hObj, pObj);
0002fe  4621              MOV      r1,r4
000300  9803              LDR      r0,[sp,#0xc]
000302  f7fffffe          BL       _CalcMenuSizeY
000306  4682              MOV      r10,r0
;;;365      if ((pObj->Height) && (pObj->Height < ySize)) {
000308  6ea0              LDR      r0,[r4,#0x68]
00030a  b120              CBZ      r0,|L1.790|
00030c  6ea0              LDR      r0,[r4,#0x68]
00030e  4550              CMP      r0,r10
000310  da01              BGE      |L1.790|
;;;366        ySize = pObj->Height;
000312  f8d4a068          LDR      r10,[r4,#0x68]
                  |L1.790|
;;;367      }
;;;368      xSize = _CalcMenuSizeX(hObj, pObj);
000316  4621              MOV      r1,r4
000318  9803              LDR      r0,[sp,#0xc]
00031a  f7fffffe          BL       _CalcMenuSizeX
00031e  4681              MOV      r9,r0
;;;369      if ((pObj->Width) && (pObj->Width < xSize)) {
000320  6e60              LDR      r0,[r4,#0x64]
000322  b120              CBZ      r0,|L1.814|
000324  6e60              LDR      r0,[r4,#0x64]
000326  4548              CMP      r0,r9
000328  da01              BGE      |L1.814|
;;;370        xSize = pObj->Width;
00032a  f8d49064          LDR      r9,[r4,#0x64]
                  |L1.814|
;;;371      }
;;;372      EffectSize = _GetEffectSize(hObj, pObj);
00032e  4621              MOV      r1,r4
000330  9803              LDR      r0,[sp,#0xc]
000332  f7fffffe          BL       _GetEffectSize
000336  4606              MOV      r6,r0
;;;373      x     -= EffectSize;
000338  1bbf              SUBS     r7,r7,r6
;;;374      y     -= EffectSize;
00033a  eba80806          SUB      r8,r8,r6
;;;375      xSize -= (EffectSize << 1);
00033e  eba90946          SUB      r9,r9,r6,LSL #1
;;;376      ySize -= (EffectSize << 1);
000342  ebaa0a46          SUB      r10,r10,r6,LSL #1
;;;377      if ((x >= 0) && (y >= 0) && (x < xSize) && (y < ySize)) {
000346  2f00              CMP      r7,#0
000348  db38              BLT      |L1.956|
00034a  f1b80f00          CMP      r8,#0
00034e  db35              BLT      |L1.956|
000350  454f              CMP      r7,r9
000352  da33              BGE      |L1.956|
000354  45d0              CMP      r8,r10
000356  da31              BGE      |L1.956|
;;;378        unsigned i, NumItems = MENU__GetNumItems(pObj);
000358  4620              MOV      r0,r4
00035a  f7fffffe          BL       MENU__GetNumItems
00035e  9001              STR      r0,[sp,#4]
;;;379        if (pObj->Flags & MENU_SF_VERTICAL) {
000360  f894005e          LDRB     r0,[r4,#0x5e]
000364  f0000001          AND      r0,r0,#1
000368  b198              CBZ      r0,|L1.914|
;;;380          int yPos = 0;
00036a  f04f0b00          MOV      r11,#0
;;;381          for (i = 0; i < NumItems; i++) {
00036e  2500              MOVS     r5,#0
000370  e00a              B        |L1.904|
                  |L1.882|
;;;382            yPos += _GetItemHeight(hObj, pObj, i);
000372  462a              MOV      r2,r5
000374  4621              MOV      r1,r4
000376  9803              LDR      r0,[sp,#0xc]
000378  f7fffffe          BL       _GetItemHeight
00037c  4483              ADD      r11,r11,r0
;;;383            if (y < yPos) {
00037e  45d8              CMP      r8,r11
000380  da01              BGE      |L1.902|
;;;384              r = i;
000382  9502              STR      r5,[sp,#8]
;;;385              break;
000384  e003              B        |L1.910|
                  |L1.902|
000386  1c6d              ADDS     r5,r5,#1              ;381
                  |L1.904|
000388  9801              LDR      r0,[sp,#4]            ;381
00038a  4285              CMP      r5,r0                 ;381
00038c  d3f1              BCC      |L1.882|
                  |L1.910|
00038e  bf00              NOP      
;;;386            }
;;;387          }
;;;388        } else {
000390  e013              B        |L1.954|
                  |L1.914|
;;;389          int xPos = 0;
000392  f04f0b00          MOV      r11,#0
;;;390          for (i = 0; i < NumItems; i++) {
000396  2500              MOVS     r5,#0
000398  e00a              B        |L1.944|
                  |L1.922|
;;;391            xPos += _GetItemWidth(hObj, pObj, i);
00039a  462a              MOV      r2,r5
00039c  4621              MOV      r1,r4
00039e  9803              LDR      r0,[sp,#0xc]
0003a0  f7fffffe          BL       _GetItemWidth
0003a4  4483              ADD      r11,r11,r0
;;;392            if (x < xPos) {
0003a6  455f              CMP      r7,r11
0003a8  da01              BGE      |L1.942|
;;;393              r = i;
0003aa  9502              STR      r5,[sp,#8]
;;;394              break;
0003ac  e003              B        |L1.950|
                  |L1.942|
0003ae  1c6d              ADDS     r5,r5,#1              ;390
                  |L1.944|
0003b0  9801              LDR      r0,[sp,#4]            ;390
0003b2  4285              CMP      r5,r0                 ;390
0003b4  d3f1              BCC      |L1.922|
                  |L1.950|
0003b6  bf00              NOP      
;;;395            }
;;;396          }
;;;397        }
0003b8  bf00              NOP      
                  |L1.954|
;;;398      }
0003ba  bf00              NOP      
                  |L1.956|
;;;399      return r;
0003bc  9802              LDR      r0,[sp,#8]
;;;400    }
0003be  b007              ADD      sp,sp,#0x1c
0003c0  e8bd8ff0          POP      {r4-r11,pc}
;;;401    
                          ENDP

                  _GetItemPos PROC
;;;405    */
;;;406    static void _GetItemPos(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index, int* px, int* py) {
0003c4  e92d5ff0          PUSH     {r4-r12,lr}
0003c8  4683              MOV      r11,r0
0003ca  4688              MOV      r8,r1
0003cc  4616              MOV      r6,r2
0003ce  461f              MOV      r7,r3
0003d0  f8dd9028          LDR      r9,[sp,#0x28]
;;;407      int i, EffectSize;
;;;408      EffectSize = _GetEffectSize(hObj, pObj);
0003d4  4641              MOV      r1,r8
0003d6  4658              MOV      r0,r11
0003d8  f7fffffe          BL       _GetEffectSize
0003dc  4605              MOV      r5,r0
;;;409      if (pObj->Flags & MENU_SF_VERTICAL) {
0003de  f898005e          LDRB     r0,[r8,#0x5e]
0003e2  f0000001          AND      r0,r0,#1
0003e6  b190              CBZ      r0,|L1.1038|
;;;410        int yPos = 0;
0003e8  f04f0a00          MOV      r10,#0
;;;411        for (i = 0; i < (int)Index; i++) {
0003ec  2400              MOVS     r4,#0
0003ee  e006              B        |L1.1022|
                  |L1.1008|
;;;412          yPos += _GetItemHeight(hObj, pObj, i);
0003f0  4622              MOV      r2,r4
0003f2  4641              MOV      r1,r8
0003f4  4658              MOV      r0,r11
0003f6  f7fffffe          BL       _GetItemHeight
0003fa  4482              ADD      r10,r10,r0
0003fc  1c64              ADDS     r4,r4,#1              ;411
                  |L1.1022|
0003fe  42b4              CMP      r4,r6                 ;411
000400  dbf6              BLT      |L1.1008|
;;;413        }
;;;414        *px = EffectSize;
000402  603d              STR      r5,[r7,#0]
;;;415        *py = EffectSize + yPos;
000404  eb05000a          ADD      r0,r5,r10
000408  f8c90000          STR      r0,[r9,#0]
;;;416      } else {
00040c  e012              B        |L1.1076|
                  |L1.1038|
;;;417        int xPos = 0;
00040e  f04f0a00          MOV      r10,#0
;;;418        for (i = 0; i < (int)Index; i++) {
000412  2400              MOVS     r4,#0
000414  e006              B        |L1.1060|
                  |L1.1046|
;;;419          xPos += _GetItemWidth(hObj, pObj, i);
000416  4622              MOV      r2,r4
000418  4641              MOV      r1,r8
00041a  4658              MOV      r0,r11
00041c  f7fffffe          BL       _GetItemWidth
000420  4482              ADD      r10,r10,r0
000422  1c64              ADDS     r4,r4,#1              ;418
                  |L1.1060|
000424  42b4              CMP      r4,r6                 ;418
000426  dbf6              BLT      |L1.1046|
;;;420        }
;;;421        *px = EffectSize + xPos;
000428  eb05000a          ADD      r0,r5,r10
00042c  6038              STR      r0,[r7,#0]
;;;422        *py = EffectSize;
00042e  f8c95000          STR      r5,[r9,#0]
;;;423      }
000432  bf00              NOP      
                  |L1.1076|
;;;424    }
000434  e8bd9ff0          POP      {r4-r12,pc}
;;;425    
                          ENDP

                  _SetCapture PROC
;;;429    */
;;;430    static void _SetCapture(MENU_Handle hObj, const MENU_Obj* pObj) {
000438  b570              PUSH     {r4-r6,lr}
00043a  4605              MOV      r5,r0
00043c  460c              MOV      r4,r1
;;;431      if (pObj->IsSubmenuActive == 0) {
00043e  f8940060          LDRB     r0,[r4,#0x60]
000442  b938              CBNZ     r0,|L1.1108|
;;;432        if (WM_HasCaptured(hObj) == 0) {
000444  4628              MOV      r0,r5
000446  f7fffffe          BL       WM_HasCaptured
00044a  b918              CBNZ     r0,|L1.1108|
;;;433          WM_SetCapture(hObj, 0);
00044c  2100              MOVS     r1,#0
00044e  4628              MOV      r0,r5
000450  f7fffffe          BL       WM_SetCapture
                  |L1.1108|
;;;434        }
;;;435      }
;;;436    }
000454  bd70              POP      {r4-r6,pc}
;;;437    
                          ENDP

                  _ReleaseCapture PROC
;;;441    */
;;;442    static void _ReleaseCapture(MENU_Handle hObj, const MENU_Obj* pObj) {
000456  b570              PUSH     {r4-r6,lr}
000458  4605              MOV      r5,r0
00045a  460c              MOV      r4,r1
;;;443      if (WM_HasCaptured(hObj)) {
00045c  4628              MOV      r0,r5
00045e  f7fffffe          BL       WM_HasCaptured
000462  b158              CBZ      r0,|L1.1148|
;;;444        if (_IsTopLevelMenu(hObj, pObj) && !(pObj->Flags & MENU_SF_POPUP)) {
000464  4621              MOV      r1,r4
000466  4628              MOV      r0,r5
000468  f7fffffe          BL       _IsTopLevelMenu
00046c  b130              CBZ      r0,|L1.1148|
00046e  f894005e          LDRB     r0,[r4,#0x5e]
000472  f0000080          AND      r0,r0,#0x80
000476  b908              CBNZ     r0,|L1.1148|
;;;445          WM_ReleaseCapture();
000478  f7fffffe          BL       WM_ReleaseCapture
                  |L1.1148|
;;;446        }
;;;447      }
;;;448    }
00047c  bd70              POP      {r4-r6,pc}
;;;449    
                          ENDP

                  MENU__InvalidateItem PROC
;;;1261   */
;;;1262   void MENU__InvalidateItem(MENU_Handle hObj, const MENU_Obj* pObj, unsigned Index) {
00047e  b570              PUSH     {r4-r6,lr}
000480  4606              MOV      r6,r0
000482  460c              MOV      r4,r1
000484  4615              MOV      r5,r2
;;;1263     GUI_USE_PARA(pObj);
000486  bf00              NOP      
;;;1264     GUI_USE_PARA(Index);
000488  bf00              NOP      
;;;1265     WM_InvalidateWindow(hObj);  /* Can be optimized, no need to invalidate all items */
00048a  4630              MOV      r0,r6
00048c  f7fffffe          BL       WM_InvalidateWindow
;;;1266   }
000490  bd70              POP      {r4-r6,pc}
;;;1267   
                          ENDP

                  _CloseSubmenu PROC
;;;453    */
;;;454    static void _CloseSubmenu(MENU_Handle hObj, MENU_Obj* pObj) {
000492  b570              PUSH     {r4-r6,lr}
000494  4606              MOV      r6,r0
000496  460c              MOV      r4,r1
;;;455      if (pObj->Flags & MENU_SF_ACTIVE) {
000498  f894005e          LDRB     r0,[r4,#0x5e]
00049c  f0000040          AND      r0,r0,#0x40
0004a0  b300              CBZ      r0,|L1.1252|
;;;456        if (pObj->IsSubmenuActive) {
0004a2  f8940060          LDRB     r0,[r4,#0x60]
0004a6  b1e8              CBZ      r0,|L1.1252|
;;;457          MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, pObj->Sel);
0004a8  f1040058          ADD      r0,r4,#0x58
0004ac  6ee1              LDR      r1,[r4,#0x6c]
0004ae  f7fffffe          BL       GUI_ARRAY_GetpItem
0004b2  4605              MOV      r5,r0
;;;458          /* Inform submenu about its deactivation and detach it */
;;;459          MENU__SendMenuMessage(hObj, pItem->hSubmenu, MENU_ON_CLOSE, 0);
0004b4  f9b51000          LDRSH    r1,[r5,#0]
0004b8  2300              MOVS     r3,#0
0004ba  2204              MOVS     r2,#4
0004bc  4630              MOV      r0,r6
0004be  f7fffffe          BL       MENU__SendMenuMessage
;;;460          WM_DetachWindow(pItem->hSubmenu);
0004c2  f9b50000          LDRSH    r0,[r5,#0]
0004c6  f7fffffe          BL       WM_DetachWindow
;;;461          pObj->IsSubmenuActive = 0;
0004ca  2000              MOVS     r0,#0
0004cc  f8840060          STRB     r0,[r4,#0x60]
;;;462          /*
;;;463           * Keep capture in menu widget. The capture may only released
;;;464           * by clicking outside the menu or when mouse moved out.
;;;465           * And it may only released from a top level menu.
;;;466           */
;;;467          _SetCapture(hObj, pObj);
0004d0  4621              MOV      r1,r4
0004d2  4630              MOV      r0,r6
0004d4  f7fffffe          BL       _SetCapture
;;;468          /* Invalidate menu item. This is needed because the appearance may have changed */
;;;469          MENU__InvalidateItem(hObj, pObj, pObj->Sel);
0004d8  4621              MOV      r1,r4
0004da  4630              MOV      r0,r6
0004dc  6ee2              LDR      r2,[r4,#0x6c]
0004de  f7fffffe          BL       MENU__InvalidateItem
;;;470        }
0004e2  bf00              NOP      
                  |L1.1252|
;;;471      }
;;;472    }
0004e4  bd70              POP      {r4-r6,pc}
;;;473    
                          ENDP

                  MENU_SetOwner PROC
;;;1390   */
;;;1391   void MENU_SetOwner(MENU_Handle hObj, WM_HWIN hOwner) {
0004e6  b570              PUSH     {r4-r6,lr}
0004e8  4604              MOV      r4,r0
0004ea  460d              MOV      r5,r1
;;;1392     if (hObj) {
0004ec  b13c              CBZ      r4,|L1.1278|
;;;1393       MENU_Obj* pObj;
;;;1394       WM_LOCK();
;;;1395       pObj = MENU_H2P(hObj);
0004ee  4620              MOV      r0,r4
0004f0  f7fffffe          BL       GUI_ALLOC_h2p
0004f4  4606              MOV      r6,r0
;;;1396       if (pObj) {
0004f6  b10e              CBZ      r6,|L1.1276|
;;;1397         pObj->hOwner = hOwner;
0004f8  f8a6505c          STRH     r5,[r6,#0x5c]
                  |L1.1276|
;;;1398       }
;;;1399       WM_UNLOCK();
;;;1400     }
0004fc  bf00              NOP      
                  |L1.1278|
;;;1401   }
0004fe  bd70              POP      {r4-r6,pc}
;;;1402   
                          ENDP

                  _OpenSubmenu PROC
;;;477    */
;;;478    static void _OpenSubmenu(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000500  e92d4ffe          PUSH     {r1-r11,lr}
000504  4606              MOV      r6,r0
000506  460c              MOV      r4,r1
000508  4617              MOV      r7,r2
;;;479      if (pObj->Flags & MENU_SF_ACTIVE) {
00050a  f894005e          LDRB     r0,[r4,#0x5e]
00050e  f0000040          AND      r0,r0,#0x40
000512  2800              CMP      r0,#0
000514  d07e              BEQ      |L1.1556|
;;;480        MENU_ITEM* pItem;
;;;481        char PrevActiveSubmenu;
;;;482        PrevActiveSubmenu = pObj->IsSubmenuActive;
000516  f8949060          LDRB     r9,[r4,#0x60]
;;;483        /* Close previous submenu (if needed) */
;;;484        _CloseSubmenu(hObj, pObj);
00051a  4621              MOV      r1,r4
00051c  4630              MOV      r0,r6
00051e  f7fffffe          BL       _CloseSubmenu
;;;485        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000522  4639              MOV      r1,r7
000524  f1040058          ADD      r0,r4,#0x58
000528  f7fffffe          BL       GUI_ARRAY_GetpItem
00052c  4605              MOV      r5,r0
;;;486        if (pItem->hSubmenu) {
00052e  8828              LDRH     r0,[r5,#0]
000530  2800              CMP      r0,#0
000532  d07f              BEQ      |L1.1588|
;;;487          if ((pItem->Flags & MENU_IF_DISABLED) == 0) {
000534  7928              LDRB     r0,[r5,#4]
000536  f0000001          AND      r0,r0,#1
00053a  2800              CMP      r0,#0
00053c  d17a              BNE      |L1.1588|
;;;488            int x, y, EffectSize;
;;;489            /* Calculate position of submenu */
;;;490            EffectSize = _GetEffectSize(hObj, pObj);
00053e  4621              MOV      r1,r4
000540  4630              MOV      r0,r6
000542  f7fffffe          BL       _GetEffectSize
000546  4680              MOV      r8,r0
;;;491            _GetItemPos(hObj, pObj, Index, &x, &y);
000548  a801              ADD      r0,sp,#4
00054a  ab02              ADD      r3,sp,#8
00054c  463a              MOV      r2,r7
00054e  4621              MOV      r1,r4
000550  9000              STR      r0,[sp,#0]
000552  4630              MOV      r0,r6
000554  f7fffffe          BL       _GetItemPos
;;;492            if (pObj->Flags & MENU_SF_VERTICAL) {
000558  f894005e          LDRB     r0,[r4,#0x5e]
00055c  f0000001          AND      r0,r0,#1
000560  b190              CBZ      r0,|L1.1416|
;;;493              x += _CalcMenuSizeX(hObj, pObj) - (_GetEffectSize(hObj, pObj) << 1);
000562  4621              MOV      r1,r4
000564  4630              MOV      r0,r6
000566  f7fffffe          BL       _CalcMenuSizeX
00056a  4682              MOV      r10,r0
00056c  4621              MOV      r1,r4
00056e  4630              MOV      r0,r6
000570  f7fffffe          BL       _GetEffectSize
000574  ebaa0040          SUB      r0,r10,r0,LSL #1
000578  9902              LDR      r1,[sp,#8]
00057a  4408              ADD      r0,r0,r1
00057c  9002              STR      r0,[sp,#8]
;;;494              y -= EffectSize;
00057e  9801              LDR      r0,[sp,#4]
000580  eba00008          SUB      r0,r0,r8
000584  9001              STR      r0,[sp,#4]
000586  e011              B        |L1.1452|
                  |L1.1416|
;;;495            } else {
;;;496              y += _CalcMenuSizeY(hObj, pObj) - (_GetEffectSize(hObj, pObj) << 1);
000588  4621              MOV      r1,r4
00058a  4630              MOV      r0,r6
00058c  f7fffffe          BL       _CalcMenuSizeY
000590  4682              MOV      r10,r0
000592  4621              MOV      r1,r4
000594  4630              MOV      r0,r6
000596  f7fffffe          BL       _GetEffectSize
00059a  ebaa0040          SUB      r0,r10,r0,LSL #1
00059e  9901              LDR      r1,[sp,#4]
0005a0  4408              ADD      r0,r0,r1
0005a2  9001              STR      r0,[sp,#4]
;;;497              x -= EffectSize;
0005a4  9802              LDR      r0,[sp,#8]
0005a6  eba00008          SUB      r0,r0,r8
0005aa  9002              STR      r0,[sp,#8]
                  |L1.1452|
;;;498            }
;;;499            x += WM_GetWindowOrgX(hObj);
0005ac  4630              MOV      r0,r6
0005ae  f7fffffe          BL       WM_GetWindowOrgX
0005b2  9902              LDR      r1,[sp,#8]
0005b4  4408              ADD      r0,r0,r1
0005b6  9002              STR      r0,[sp,#8]
;;;500            y += WM_GetWindowOrgY(hObj);
0005b8  4630              MOV      r0,r6
0005ba  f7fffffe          BL       WM_GetWindowOrgY
0005be  9901              LDR      r1,[sp,#4]
0005c0  4408              ADD      r0,r0,r1
0005c2  9001              STR      r0,[sp,#4]
;;;501            /*
;;;502             * Notify owner window when for the first time open a menu (when no
;;;503             * other submenu was open), so it can initialize the menu items.
;;;504             */
;;;505            if (PrevActiveSubmenu == 0) {
0005c4  f1b90f00          CMP      r9,#0
0005c8  d10b              BNE      |L1.1506|
;;;506              if (_IsTopLevelMenu(hObj, pObj)) {
0005ca  4621              MOV      r1,r4
0005cc  4630              MOV      r0,r6
0005ce  f7fffffe          BL       _IsTopLevelMenu
0005d2  b130              CBZ      r0,|L1.1506|
;;;507                MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_INITMENU, 0);
0005d4  f9b4105c          LDRSH    r1,[r4,#0x5c]
0005d8  2300              MOVS     r3,#0
0005da  2201              MOVS     r2,#1
0005dc  4630              MOV      r0,r6
0005de  f7fffffe          BL       MENU__SendMenuMessage
                  |L1.1506|
;;;508              }
;;;509            }
;;;510            /* Notify owner window when a submenu opens, so it can initialize the menu items. */
;;;511            MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_INITSUBMENU, pItem->Id);
0005e2  886b              LDRH     r3,[r5,#2]
0005e4  f9b4105c          LDRSH    r1,[r4,#0x5c]
0005e8  2202              MOVS     r2,#2
0005ea  4630              MOV      r0,r6
0005ec  f7fffffe          BL       MENU__SendMenuMessage
;;;512            /* Set active menu as owner of submenu. */
;;;513            MENU_SetOwner(pItem->hSubmenu, hObj);
0005f0  f9b50000          LDRSH    r0,[r5,#0]
0005f4  4631              MOV      r1,r6
0005f6  f7fffffe          BL       MENU_SetOwner
;;;514            /* Attach submenu and inform it about its activation. */
;;;515            WM_AttachWindowAt(pItem->hSubmenu, WM_HBKWIN, x, y);
0005fa  f7fffffe          BL       WM_GetDesktopWindow
0005fe  4682              MOV      r10,r0
000600  f9b50000          LDRSH    r0,[r5,#0]
000604  4651              MOV      r1,r10
000606  e9dd3201          LDRD     r3,r2,[sp,#4]
00060a  f7fffffe          BL       WM_AttachWindowAt
;;;516            MENU__SendMenuMessage(hObj, pItem->hSubmenu, MENU_ON_OPEN, 0);
00060e  f9b51000          LDRSH    r1,[r5,#0]
000612  e001              B        |L1.1560|
                  |L1.1556|
000614  e00f              B        |L1.1590|
000616  e00d              B        |L1.1588|
                  |L1.1560|
000618  2300              MOVS     r3,#0
00061a  2203              MOVS     r2,#3
00061c  4630              MOV      r0,r6
00061e  f7fffffe          BL       MENU__SendMenuMessage
;;;517            pObj->IsSubmenuActive = 1;
000622  2001              MOVS     r0,#1
000624  f8840060          STRB     r0,[r4,#0x60]
;;;518            /* Invalidate menu item. This is needed because the appearance may have changed. */
;;;519            MENU__InvalidateItem(hObj, pObj, Index);
000628  463a              MOV      r2,r7
00062a  4621              MOV      r1,r4
00062c  4630              MOV      r0,r6
00062e  f7fffffe          BL       MENU__InvalidateItem
;;;520          }
000632  bf00              NOP      
                  |L1.1588|
;;;521        }
;;;522      }
000634  bf00              NOP      
                  |L1.1590|
;;;523    }
000636  e8bd8ffe          POP      {r1-r11,pc}
;;;524    
                          ENDP

                  _ClosePopup PROC
;;;528    */
;;;529    static void _ClosePopup(MENU_Handle hObj, MENU_Obj* pObj) {
00063a  b570              PUSH     {r4-r6,lr}
00063c  4605              MOV      r5,r0
00063e  460c              MOV      r4,r1
;;;530      if (pObj->Flags & MENU_SF_POPUP) {
000640  f894005e          LDRB     r0,[r4,#0x5e]
000644  f0000080          AND      r0,r0,#0x80
000648  b150              CBZ      r0,|L1.1632|
;;;531        pObj->Flags &= ~(MENU_SF_POPUP);
00064a  f8b4005e          LDRH     r0,[r4,#0x5e]
00064e  f0200080          BIC      r0,r0,#0x80
000652  f8a4005e          STRH     r0,[r4,#0x5e]
;;;532        WM_DetachWindow(hObj);
000656  4628              MOV      r0,r5
000658  f7fffffe          BL       WM_DetachWindow
;;;533        WM_ReleaseCapture();
00065c  f7fffffe          BL       WM_ReleaseCapture
                  |L1.1632|
;;;534      }
;;;535    }
000660  bd70              POP      {r4-r6,pc}
;;;536    
                          ENDP

                  _SetSelection PROC
;;;540    */
;;;541    static void _SetSelection(MENU_Handle hObj, MENU_Obj* pObj, int Index) {
000662  b570              PUSH     {r4-r6,lr}
000664  4606              MOV      r6,r0
000666  460c              MOV      r4,r1
000668  4615              MOV      r5,r2
;;;542      if (Index != pObj->Sel) {
00066a  6ee0              LDR      r0,[r4,#0x6c]
00066c  42a8              CMP      r0,r5
00066e  d00a              BEQ      |L1.1670|
;;;543        pObj->Sel = Index;
000670  66e5              STR      r5,[r4,#0x6c]
;;;544        MENU__InvalidateItem(hObj, pObj, pObj->Sel); /* Invalidate previous selection */
000672  4621              MOV      r1,r4
000674  4630              MOV      r0,r6
000676  6ee2              LDR      r2,[r4,#0x6c]
000678  f7fffffe          BL       MENU__InvalidateItem
;;;545        MENU__InvalidateItem(hObj, pObj, Index);     /* Invalidate new selection */
00067c  462a              MOV      r2,r5
00067e  4621              MOV      r1,r4
000680  4630              MOV      r0,r6
000682  f7fffffe          BL       MENU__InvalidateItem
                  |L1.1670|
;;;546      }
;;;547    }
000686  bd70              POP      {r4-r6,pc}
;;;548    
                          ENDP

                  _SelectItem PROC
;;;552    */
;;;553    static void _SelectItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000688  b570              PUSH     {r4-r6,lr}
00068a  4606              MOV      r6,r0
00068c  460c              MOV      r4,r1
00068e  4615              MOV      r5,r2
;;;554      if (pObj->Sel != (int)Index) {
000690  6ee0              LDR      r0,[r4,#0x6c]
000692  42a8              CMP      r0,r5
000694  d00d              BEQ      |L1.1714|
;;;555        _SetCapture(hObj, pObj);
000696  4621              MOV      r1,r4
000698  4630              MOV      r0,r6
00069a  f7fffffe          BL       _SetCapture
;;;556        _OpenSubmenu(hObj, pObj, Index);
00069e  462a              MOV      r2,r5
0006a0  4621              MOV      r1,r4
0006a2  4630              MOV      r0,r6
0006a4  f7fffffe          BL       _OpenSubmenu
;;;557        _SetSelection(hObj, pObj, Index);
0006a8  462a              MOV      r2,r5
0006aa  4621              MOV      r1,r4
0006ac  4630              MOV      r0,r6
0006ae  f7fffffe          BL       _SetSelection
                  |L1.1714|
;;;558      }
;;;559    }
0006b2  bd70              POP      {r4-r6,pc}
;;;560    
                          ENDP

                  _DeselectItem PROC
;;;564    */
;;;565    static void _DeselectItem(MENU_Handle hObj, MENU_Obj* pObj) {
0006b4  b570              PUSH     {r4-r6,lr}
0006b6  4605              MOV      r5,r0
0006b8  460c              MOV      r4,r1
;;;566      if (pObj->IsSubmenuActive == 0) {
0006ba  f8940060          LDRB     r0,[r4,#0x60]
0006be  b948              CBNZ     r0,|L1.1748|
;;;567        _SetSelection(hObj, pObj, -1);
0006c0  f04f32ff          MOV      r2,#0xffffffff
0006c4  4621              MOV      r1,r4
0006c6  4628              MOV      r0,r5
0006c8  f7fffffe          BL       _SetSelection
;;;568        _ReleaseCapture(hObj, pObj);
0006cc  4621              MOV      r1,r4
0006ce  4628              MOV      r0,r5
0006d0  f7fffffe          BL       _ReleaseCapture
                  |L1.1748|
;;;569      }
;;;570    }
0006d4  bd70              POP      {r4-r6,pc}
;;;571    
                          ENDP

                  _ActivateItem PROC
;;;575    */
;;;576    static void _ActivateItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
0006d6  e92d41f0          PUSH     {r4-r8,lr}
0006da  4607              MOV      r7,r0
0006dc  460c              MOV      r4,r1
0006de  4616              MOV      r6,r2
;;;577      MENU_ITEM* pItem;
;;;578      pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
0006e0  4631              MOV      r1,r6
0006e2  f1040058          ADD      r0,r4,#0x58
0006e6  f7fffffe          BL       GUI_ARRAY_GetpItem
0006ea  4605              MOV      r5,r0
;;;579      if (pItem->hSubmenu == 0) {
0006ec  8828              LDRH     r0,[r5,#0]
0006ee  b970              CBNZ     r0,|L1.1806|
;;;580        if ((pItem->Flags & (MENU_IF_DISABLED | MENU_IF_SEPARATOR)) == 0) {
0006f0  7928              LDRB     r0,[r5,#4]
0006f2  f0000003          AND      r0,r0,#3
0006f6  b950              CBNZ     r0,|L1.1806|
;;;581          _ClosePopup(hObj, pObj);
0006f8  4621              MOV      r1,r4
0006fa  4638              MOV      r0,r7
0006fc  f7fffffe          BL       _ClosePopup
;;;582          /* Send item select message to owner. */
;;;583          MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_ITEMSELECT, pItem->Id);
000700  886b              LDRH     r3,[r5,#2]
000702  f9b4105c          LDRSH    r1,[r4,#0x5c]
000706  2200              MOVS     r2,#0
000708  4638              MOV      r0,r7
00070a  f7fffffe          BL       MENU__SendMenuMessage
                  |L1.1806|
;;;584        }
;;;585      }
;;;586    }
00070e  e8bd81f0          POP      {r4-r8,pc}
;;;587    
                          ENDP

                  _ActivateMenu PROC
;;;591    */
;;;592    static void _ActivateMenu(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000712  e92d41f0          PUSH     {r4-r8,lr}
000716  4607              MOV      r7,r0
000718  460c              MOV      r4,r1
00071a  4615              MOV      r5,r2
;;;593      if ((pObj->Flags & MENU_SF_OPEN_ON_POINTEROVER) == 0) {
00071c  f894005e          LDRB     r0,[r4,#0x5e]
000720  f0000002          AND      r0,r0,#2
000724  bba0              CBNZ     r0,|L1.1936|
;;;594        MENU_ITEM* pItem;
;;;595        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000726  4629              MOV      r1,r5
000728  f1040058          ADD      r0,r4,#0x58
00072c  f7fffffe          BL       GUI_ARRAY_GetpItem
000730  4606              MOV      r6,r0
;;;596        if (pItem->hSubmenu) {
000732  8830              LDRH     r0,[r6,#0]
000734  b358              CBZ      r0,|L1.1934|
;;;597          if ((pItem->Flags & MENU_IF_DISABLED) == 0) {
000736  7930              LDRB     r0,[r6,#4]
000738  f0000001          AND      r0,r0,#1
00073c  bb38              CBNZ     r0,|L1.1934|
;;;598            if ((pObj->Flags & MENU_SF_ACTIVE) == 0) {
00073e  f894005e          LDRB     r0,[r4,#0x5e]
000742  f0000040          AND      r0,r0,#0x40
000746  b980              CBNZ     r0,|L1.1898|
;;;599              pObj->Flags |= MENU_SF_ACTIVE;
000748  f8b4005e          LDRH     r0,[r4,#0x5e]
00074c  f0400040          ORR      r0,r0,#0x40
000750  f8a4005e          STRH     r0,[r4,#0x5e]
;;;600              _OpenSubmenu(hObj, pObj, Index);
000754  462a              MOV      r2,r5
000756  4621              MOV      r1,r4
000758  4638              MOV      r0,r7
00075a  f7fffffe          BL       _OpenSubmenu
;;;601              _SetSelection(hObj, pObj, Index);
00075e  462a              MOV      r2,r5
000760  4621              MOV      r1,r4
000762  4638              MOV      r0,r7
000764  f7fffffe          BL       _SetSelection
000768  e011              B        |L1.1934|
                  |L1.1898|
;;;602            } else if (pObj->Flags & MENU_SF_CLOSE_ON_SECOND_CLICK) {
00076a  f894005e          LDRB     r0,[r4,#0x5e]
00076e  f0000004          AND      r0,r0,#4
000772  b160              CBZ      r0,|L1.1934|
;;;603              if ((int)Index == pObj->Sel) {
000774  6ee0              LDR      r0,[r4,#0x6c]
000776  42a8              CMP      r0,r5
000778  d109              BNE      |L1.1934|
;;;604                _CloseSubmenu(hObj, pObj);
00077a  4621              MOV      r1,r4
00077c  4638              MOV      r0,r7
00077e  f7fffffe          BL       _CloseSubmenu
;;;605                pObj->Flags &= ~MENU_SF_ACTIVE;
000782  f8b4005e          LDRH     r0,[r4,#0x5e]
000786  f0200040          BIC      r0,r0,#0x40
00078a  f8a4005e          STRH     r0,[r4,#0x5e]
                  |L1.1934|
;;;606              }
;;;607            }
;;;608          }
;;;609        }
;;;610      }
00078e  bf00              NOP      
                  |L1.1936|
;;;611    }
000790  e8bd81f0          POP      {r4-r8,pc}
;;;612    
                          ENDP

                  _DeactivateMenu PROC
;;;616    */
;;;617    static void _DeactivateMenu(MENU_Handle hObj, MENU_Obj* pObj) {
000794  b570              PUSH     {r4-r6,lr}
000796  4605              MOV      r5,r0
000798  460c              MOV      r4,r1
;;;618      _CloseSubmenu(hObj, pObj);
00079a  4621              MOV      r1,r4
00079c  4628              MOV      r0,r5
00079e  f7fffffe          BL       _CloseSubmenu
;;;619      if ((pObj->Flags & MENU_SF_OPEN_ON_POINTEROVER) == 0) {
0007a2  f894005e          LDRB     r0,[r4,#0x5e]
0007a6  f0000002          AND      r0,r0,#2
0007aa  b928              CBNZ     r0,|L1.1976|
;;;620        pObj->Flags &= ~MENU_SF_ACTIVE;
0007ac  f8b4005e          LDRH     r0,[r4,#0x5e]
0007b0  f0200040          BIC      r0,r0,#0x40
0007b4  f8a4005e          STRH     r0,[r4,#0x5e]
                  |L1.1976|
;;;621      }
;;;622    }
0007b8  bd70              POP      {r4-r6,pc}
;;;623    
                          ENDP

                  _HandlePID PROC
;;;662    */
;;;663    static char _HandlePID(MENU_Handle hObj, MENU_Obj* pObj, int x, int y, int Pressed) {
0007ba  e92d47f0          PUSH     {r4-r10,lr}
0007be  b086              SUB      sp,sp,#0x18
0007c0  4681              MOV      r9,r0
0007c2  460d              MOV      r5,r1
0007c4  4616              MOV      r6,r2
0007c6  461f              MOV      r7,r3
0007c8  9c0e              LDR      r4,[sp,#0x38]
;;;664      GUI_PID_STATE PrevState;
;;;665      char XYInWidget = 0;
0007ca  f04f0a00          MOV      r10,#0
;;;666      WM_PID__GetPrevState(&PrevState);
0007ce  a803              ADD      r0,sp,#0xc
0007d0  f7fffffe          BL       WM_PID__GetPrevState
;;;667      /*
;;;668       * Check if coordinates are inside the widget.
;;;669       */
;;;670      if ((x >= 0) && (y >= 0)) {
0007d4  2e00              CMP      r6,#0
0007d6  db10              BLT      |L1.2042|
0007d8  2f00              CMP      r7,#0
0007da  db0e              BLT      |L1.2042|
;;;671        GUI_RECT r;
;;;672        WM__GetClientRectWin(&pObj->Widget.Win, &r);
0007dc  a901              ADD      r1,sp,#4
0007de  4628              MOV      r0,r5
0007e0  f7fffffe          BL       WM__GetClientRectWin
;;;673        if ((x <= r.x1) && (y <= r.y1)) {
0007e4  f9bd0008          LDRSH    r0,[sp,#8]
0007e8  42b0              CMP      r0,r6
0007ea  db05              BLT      |L1.2040|
0007ec  f9bd000a          LDRSH    r0,[sp,#0xa]
0007f0  42b8              CMP      r0,r7
0007f2  db01              BLT      |L1.2040|
;;;674          XYInWidget = 1;
0007f4  f04f0a01          MOV      r10,#1
                  |L1.2040|
;;;675        }
;;;676      }
0007f8  bf00              NOP      
                  |L1.2042|
;;;677    
;;;678      if (XYInWidget) {
0007fa  f1ba0f00          CMP      r10,#0
0007fe  d04b              BEQ      |L1.2200|
;;;679        int ItemIndex;
;;;680        ItemIndex = _GetItemFromPos(hObj, pObj, x, y);
000800  463b              MOV      r3,r7
000802  4632              MOV      r2,r6
000804  4629              MOV      r1,r5
000806  4648              MOV      r0,r9
000808  f7fffffe          BL       _GetItemFromPos
00080c  4680              MOV      r8,r0
;;;681        /* 
;;;682         * Handle PID when coordinates are inside the widget.
;;;683         */
;;;684        if (ItemIndex >= 0) {
00080e  f1b80f00          CMP      r8,#0
000812  db24              BLT      |L1.2142|
;;;685          /* 
;;;686           * Coordinates are inside the menu.
;;;687           */
;;;688          if (Pressed > 0) {
000814  2c00              CMP      r4,#0
000816  dd0f              BLE      |L1.2104|
;;;689            if ((PrevState.Pressed == 0) && (Pressed == 1)) {  /* Clicked */
000818  f89d0014          LDRB     r0,[sp,#0x14]
00081c  b930              CBNZ     r0,|L1.2092|
00081e  2c01              CMP      r4,#1
000820  d104              BNE      |L1.2092|
;;;690              _ActivateMenu(hObj, pObj, ItemIndex);
000822  4642              MOV      r2,r8
000824  4629              MOV      r1,r5
000826  4648              MOV      r0,r9
000828  f7fffffe          BL       _ActivateMenu
                  |L1.2092|
;;;691            }
;;;692            _SelectItem(hObj, pObj, ItemIndex);
00082c  4642              MOV      r2,r8
00082e  4629              MOV      r1,r5
000830  4648              MOV      r0,r9
000832  f7fffffe          BL       _SelectItem
000836  e02b              B        |L1.2192|
                  |L1.2104|
;;;693          } else if ((Pressed == 0) && (PrevState.Pressed == 1)) {  /* Released */
000838  b94c              CBNZ     r4,|L1.2126|
00083a  f89d0014          LDRB     r0,[sp,#0x14]
00083e  2801              CMP      r0,#1
000840  d105              BNE      |L1.2126|
;;;694            _ActivateItem(hObj, pObj, ItemIndex);
000842  4642              MOV      r2,r8
000844  4629              MOV      r1,r5
000846  4648              MOV      r0,r9
000848  f7fffffe          BL       _ActivateItem
00084c  e020              B        |L1.2192|
                  |L1.2126|
;;;695          } else if (Pressed < 0) {  /* Mouse moved */
00084e  2c00              CMP      r4,#0
000850  da1e              BGE      |L1.2192|
;;;696            #if (GUI_SUPPORT_MOUSE)
;;;697              if (_ForwardMouseOverMsg(hObj, pObj, x, y) != 0) {
;;;698                _DeselectItem(hObj, pObj);
;;;699              } else
;;;700            #endif
;;;701            {
;;;702              _SelectItem(hObj, pObj, ItemIndex);
000852  4642              MOV      r2,r8
000854  4629              MOV      r1,r5
000856  4648              MOV      r0,r9
000858  f7fffffe          BL       _SelectItem
00085c  e018              B        |L1.2192|
                  |L1.2142|
;;;703            }
;;;704          }
;;;705        } else {
;;;706          /* 
;;;707           * Coordinates are outside the menu but inside the widget.
;;;708           */
;;;709          if (Pressed > 0) {
00085e  2c00              CMP      r4,#0
000860  dd0b              BLE      |L1.2170|
;;;710            if (PrevState.Pressed == 0) {  /* Clicked */
000862  f89d0014          LDRB     r0,[sp,#0x14]
000866  b918              CBNZ     r0,|L1.2160|
;;;711              /* 
;;;712               * User has clicked outside the menu. Close the active submenu.
;;;713               * The widget itself must be closed (if needed) by the owner.
;;;714               */
;;;715              _DeactivateMenu(hObj, pObj);
000868  4629              MOV      r1,r5
00086a  4648              MOV      r0,r9
00086c  f7fffffe          BL       _DeactivateMenu
                  |L1.2160|
;;;716            }
;;;717            _DeselectItem(hObj, pObj);
000870  4629              MOV      r1,r5
000872  4648              MOV      r0,r9
000874  f7fffffe          BL       _DeselectItem
000878  e00a              B        |L1.2192|
                  |L1.2170|
;;;718          } else if (Pressed < 0) {  /* Moved out or mouse moved */
00087a  2c00              CMP      r4,#0
00087c  da08              BGE      |L1.2192|
;;;719            if (!(pObj->Widget.State & WIDGET_STATE_FOCUS)) {
00087e  f8950026          LDRB     r0,[r5,#0x26]
000882  f0000001          AND      r0,r0,#1
000886  b918              CBNZ     r0,|L1.2192|
;;;720              _DeselectItem(hObj, pObj);
000888  4629              MOV      r1,r5
00088a  4648              MOV      r0,r9
00088c  f7fffffe          BL       _DeselectItem
                  |L1.2192|
;;;721            }
;;;722          }
;;;723        }
;;;724        return 0;
000890  2000              MOVS     r0,#0
                  |L1.2194|
;;;725      } else {
;;;726        /* 
;;;727         * Handle PID when coordinates are outside the widget.
;;;728         */
;;;729        if ((Pressed > 0) && (PrevState.Pressed == 0)) {
;;;730          /* 
;;;731           * User has clicked outside the menu. Close the active submenu.
;;;732           * The widget itself must be closed (if needed) by the owner.
;;;733           */
;;;734          _DeselectItem(hObj, pObj);
;;;735          _DeactivateMenu(hObj, pObj);
;;;736          _ClosePopup(hObj, pObj);
;;;737          _SetSelection(hObj, pObj, -1);
;;;738          if (pObj->Widget.State & WIDGET_STATE_FOCUS) {
;;;739            MENU_Handle hObjTopLevel; 
;;;740            MENU_Obj *  pObjTopLevel;
;;;741            _GetTopLevelMenu(hObj, pObj, &hObjTopLevel, &pObjTopLevel, 0);
;;;742            WM_SetFocus(hObjTopLevel);
;;;743            _SetSelection(hObjTopLevel, pObjTopLevel, -1);
;;;744            _ReleaseCapture(hObjTopLevel, pObjTopLevel);
;;;745          }
;;;746        }
;;;747        if (!(pObj->Widget.State & WIDGET_STATE_FOCUS)) {
;;;748          _DeselectItem(hObj, pObj);
;;;749        }
;;;750        #if (GUI_SUPPORT_MOUSE)
;;;751          _ForwardMouseOverMsg(hObj, pObj, x, y);
;;;752        #endif
;;;753      }
;;;754      return 1;   /* Coordinates are not in widget, we need to forward PID message to owner */
;;;755    }
000892  b006              ADD      sp,sp,#0x18
000894  e8bd87f0          POP      {r4-r10,pc}
                  |L1.2200|
000898  2c00              CMP      r4,#0                 ;729
00089a  dd32              BLE      |L1.2306|
00089c  f89d0014          LDRB     r0,[sp,#0x14]         ;729
0008a0  bb78              CBNZ     r0,|L1.2306|
0008a2  4629              MOV      r1,r5                 ;734
0008a4  4648              MOV      r0,r9                 ;734
0008a6  f7fffffe          BL       _DeselectItem
0008aa  4629              MOV      r1,r5                 ;735
0008ac  4648              MOV      r0,r9                 ;735
0008ae  f7fffffe          BL       _DeactivateMenu
0008b2  4629              MOV      r1,r5                 ;736
0008b4  4648              MOV      r0,r9                 ;736
0008b6  f7fffffe          BL       _ClosePopup
0008ba  f04f32ff          MOV      r2,#0xffffffff        ;737
0008be  4629              MOV      r1,r5                 ;737
0008c0  4648              MOV      r0,r9                 ;737
0008c2  f7fffffe          BL       _SetSelection
0008c6  f8950026          LDRB     r0,[r5,#0x26]         ;738
0008ca  f0000001          AND      r0,r0,#1              ;738
0008ce  b1c0              CBZ      r0,|L1.2306|
0008d0  2000              MOVS     r0,#0                 ;741
0008d2  ab01              ADD      r3,sp,#4              ;741
0008d4  aa02              ADD      r2,sp,#8              ;741
0008d6  4629              MOV      r1,r5                 ;741
0008d8  9000              STR      r0,[sp,#0]            ;741
0008da  4648              MOV      r0,r9                 ;741
0008dc  f7fffffe          BL       _GetTopLevelMenu
0008e0  f9bd0008          LDRSH    r0,[sp,#8]            ;742
0008e4  f7fffffe          BL       WM_SetFocus
0008e8  f04f32ff          MOV      r2,#0xffffffff        ;743
0008ec  f9bd0008          LDRSH    r0,[sp,#8]            ;743
0008f0  9901              LDR      r1,[sp,#4]            ;743
0008f2  f7fffffe          BL       _SetSelection
0008f6  f9bd0008          LDRSH    r0,[sp,#8]            ;744
0008fa  9901              LDR      r1,[sp,#4]            ;744
0008fc  f7fffffe          BL       _ReleaseCapture
000900  bf00              NOP                            ;745
                  |L1.2306|
000902  f8950026          LDRB     r0,[r5,#0x26]         ;747
000906  f0000001          AND      r0,r0,#1              ;747
00090a  b918              CBNZ     r0,|L1.2324|
00090c  4629              MOV      r1,r5                 ;748
00090e  4648              MOV      r0,r9                 ;748
000910  f7fffffe          BL       _DeselectItem
                  |L1.2324|
000914  2001              MOVS     r0,#1                 ;754
000916  e7bc              B        |L1.2194|
;;;756    
                          ENDP

                  _ForwardPIDMsgToOwner PROC
;;;760    */
;;;761    static void _ForwardPIDMsgToOwner(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000918  e92d47f0          PUSH     {r4-r10,lr}
00091c  4680              MOV      r8,r0
00091e  460e              MOV      r6,r1
000920  4614              MOV      r4,r2
;;;762      if (_IsTopLevelMenu(hObj, pObj) == 0) {
000922  4631              MOV      r1,r6
000924  4640              MOV      r0,r8
000926  f7fffffe          BL       _IsTopLevelMenu
00092a  bb58              CBNZ     r0,|L1.2436|
;;;763        WM_HWIN hOwner;
;;;764        hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
00092c  f8b6005c          LDRH     r0,[r6,#0x5c]
000930  b110              CBZ      r0,|L1.2360|
000932  f9b6005c          LDRSH    r0,[r6,#0x5c]
000936  e002              B        |L1.2366|
                  |L1.2360|
000938  4640              MOV      r0,r8
00093a  f7fffffe          BL       WM_GetParent
                  |L1.2366|
00093e  4607              MOV      r7,r0
;;;765        if (hOwner) {
000940  b1ff              CBZ      r7,|L1.2434|
;;;766          if (pMsg->Data.p) {
000942  68a0              LDR      r0,[r4,#8]
000944  b1c8              CBZ      r0,|L1.2426|
;;;767            GUI_PID_STATE* pState;
;;;768            pState = (GUI_PID_STATE*)pMsg->Data.p;
000946  68a5              LDR      r5,[r4,#8]
;;;769            pState->x += WM_GetWindowOrgX(hObj) - WM_GetWindowOrgX(hOwner);
000948  4640              MOV      r0,r8
00094a  f7fffffe          BL       WM_GetWindowOrgX
00094e  4681              MOV      r9,r0
000950  4638              MOV      r0,r7
000952  f7fffffe          BL       WM_GetWindowOrgX
000956  eba90000          SUB      r0,r9,r0
00095a  6829              LDR      r1,[r5,#0]
00095c  4408              ADD      r0,r0,r1
00095e  6028              STR      r0,[r5,#0]
;;;770            pState->y += WM_GetWindowOrgY(hObj) - WM_GetWindowOrgY(hOwner);
000960  4640              MOV      r0,r8
000962  f7fffffe          BL       WM_GetWindowOrgY
000966  4681              MOV      r9,r0
000968  4638              MOV      r0,r7
00096a  f7fffffe          BL       WM_GetWindowOrgY
00096e  eba90000          SUB      r0,r9,r0
000972  6869              LDR      r1,[r5,#4]
000974  4408              ADD      r0,r0,r1
000976  6068              STR      r0,[r5,#4]
;;;771          }
000978  bf00              NOP      
                  |L1.2426|
;;;772          WM__SendMessage(hOwner, pMsg);
00097a  4621              MOV      r1,r4
00097c  4638              MOV      r0,r7
00097e  f7fffffe          BL       WM__SendMessage
                  |L1.2434|
;;;773        }
;;;774      }
000982  bf00              NOP      
                  |L1.2436|
;;;775    }
000984  e8bd87f0          POP      {r4-r10,pc}
;;;776    
                          ENDP

                  MENU__ResizeMenu PROC
;;;1288   */
;;;1289   void MENU__ResizeMenu(MENU_Handle hObj, MENU_Obj* pObj) {
000988  e92d41f0          PUSH     {r4-r8,lr}
00098c  4604              MOV      r4,r0
00098e  460d              MOV      r5,r1
;;;1290     int xSize, ySize;
;;;1291     xSize = _CalcWindowSizeX(hObj, pObj);
000990  4629              MOV      r1,r5
000992  4620              MOV      r0,r4
000994  f7fffffe          BL       _CalcWindowSizeX
000998  4606              MOV      r6,r0
;;;1292     ySize = _CalcWindowSizeY(hObj, pObj);
00099a  4629              MOV      r1,r5
00099c  4620              MOV      r0,r4
00099e  f7fffffe          BL       _CalcWindowSizeY
0009a2  4607              MOV      r7,r0
;;;1293     WM_SetSize(hObj, xSize, ySize);
0009a4  463a              MOV      r2,r7
0009a6  4631              MOV      r1,r6
0009a8  4620              MOV      r0,r4
0009aa  f7fffffe          BL       WM_SetSize
;;;1294     WM_InvalidateWindow(hObj);
0009ae  4620              MOV      r0,r4
0009b0  f7fffffe          BL       WM_InvalidateWindow
;;;1295   }
0009b4  e8bd81f0          POP      {r4-r8,pc}
;;;1296   
                          ENDP

                  _OnMenu PROC
;;;786    */
;;;787    static void _OnMenu(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
0009b8  e92d41f0          PUSH     {r4-r8,lr}
0009bc  4606              MOV      r6,r0
0009be  460c              MOV      r4,r1
0009c0  4615              MOV      r5,r2
;;;788      const MENU_MSG_DATA* pData = (const MENU_MSG_DATA*)pMsg->Data.p;
0009c2  68af              LDR      r7,[r5,#8]
;;;789      if (pData) {
0009c4  2f00              CMP      r7,#0
0009c6  d046              BEQ      |L1.2646|
;;;790        switch (pData->MsgType) {
0009c8  8838              LDRH     r0,[r7,#0]
0009ca  2806              CMP      r0,#6
0009cc  d242              BCS      |L1.2644|
0009ce  e8dff000          TBB      [pc,r0]
0009d2  0310              DCB      0x03,0x10
0009d4  1124393e          DCB      0x11,0x24,0x39,0x3e
;;;791        case MENU_ON_ITEMSELECT:
;;;792          _DeactivateMenu(hObj, pObj);
0009d8  4621              MOV      r1,r4
0009da  4630              MOV      r0,r6
0009dc  f7fffffe          BL       _DeactivateMenu
;;;793          _DeselectItem(hObj, pObj);
0009e0  4621              MOV      r1,r4
0009e2  4630              MOV      r0,r6
0009e4  f7fffffe          BL       _DeselectItem
;;;794          _ClosePopup(hObj, pObj);
0009e8  4621              MOV      r1,r4
0009ea  4630              MOV      r0,r6
0009ec  f7fffffe          BL       _ClosePopup
;;;795          /* No break here. We need to forward message to owner. */
;;;796        case MENU_ON_INITMENU:
0009f0  bf00              NOP      
;;;797        case MENU_ON_INITSUBMENU:
0009f2  bf00              NOP      
;;;798          /* Forward message to owner. */
;;;799          {
;;;800            WM_HWIN hOwner;
;;;801            hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
0009f4  f8b4005c          LDRH     r0,[r4,#0x5c]
0009f8  b110              CBZ      r0,|L1.2560|
0009fa  f9b4005c          LDRSH    r0,[r4,#0x5c]
0009fe  e002              B        |L1.2566|
                  |L1.2560|
000a00  4630              MOV      r0,r6
000a02  f7fffffe          BL       WM_GetParent
                  |L1.2566|
000a06  4680              MOV      r8,r0
;;;802            if (hOwner) {
000a08  f1b80f00          CMP      r8,#0
000a0c  d004              BEQ      |L1.2584|
;;;803              pMsg->hWinSrc = hObj;
000a0e  80ee              STRH     r6,[r5,#6]
;;;804              WM__SendMessage(hOwner, pMsg);
000a10  4629              MOV      r1,r5
000a12  4640              MOV      r0,r8
000a14  f7fffffe          BL       WM__SendMessage
                  |L1.2584|
;;;805            }
;;;806          }
;;;807          break;
000a18  e01c              B        |L1.2644|
;;;808        case MENU_ON_OPEN:
;;;809          pObj->Sel = -1;
000a1a  f04f30ff          MOV      r0,#0xffffffff
000a1e  66e0              STR      r0,[r4,#0x6c]
;;;810          pObj->IsSubmenuActive = 0;
000a20  2000              MOVS     r0,#0
000a22  f8840060          STRB     r0,[r4,#0x60]
;;;811          pObj->Flags |= MENU_SF_ACTIVE | MENU_SF_OPEN_ON_POINTEROVER;
000a26  f8b4005e          LDRH     r0,[r4,#0x5e]
000a2a  f0400042          ORR      r0,r0,#0x42
000a2e  f8a4005e          STRH     r0,[r4,#0x5e]
;;;812          _SetCapture(hObj, pObj);
000a32  4621              MOV      r1,r4
000a34  4630              MOV      r0,r6
000a36  f7fffffe          BL       _SetCapture
;;;813          MENU__ResizeMenu(hObj, pObj);
000a3a  4621              MOV      r1,r4
000a3c  4630              MOV      r0,r6
000a3e  f7fffffe          BL       MENU__ResizeMenu
;;;814          break;
000a42  e007              B        |L1.2644|
;;;815        case MENU_ON_CLOSE:
;;;816          _CloseSubmenu(hObj, pObj);
000a44  4621              MOV      r1,r4
000a46  4630              MOV      r0,r6
000a48  f7fffffe          BL       _CloseSubmenu
;;;817          break;
000a4c  e002              B        |L1.2644|
;;;818        case MENU_IS_MENU:
;;;819          pMsg->Data.v = 1;
000a4e  2001              MOVS     r0,#1
000a50  60a8              STR      r0,[r5,#8]
;;;820          break;
000a52  bf00              NOP      
                  |L1.2644|
000a54  bf00              NOP                            ;807
                  |L1.2646|
;;;821        }
;;;822      }
;;;823    }
000a56  e8bd81f0          POP      {r4-r8,pc}
;;;824    
                          ENDP

                  _OnTouch PROC
;;;828    */
;;;829    static char _OnTouch(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000a5a  b5f8              PUSH     {r3-r7,lr}
000a5c  4606              MOV      r6,r0
000a5e  460f              MOV      r7,r1
000a60  4615              MOV      r5,r2
;;;830      const GUI_PID_STATE* pState = (const GUI_PID_STATE*)pMsg->Data.p;
000a62  68ac              LDR      r4,[r5,#8]
;;;831      if (pState) {  /* Something happened in our area (pressed or released) */
000a64  b144              CBZ      r4,|L1.2680|
;;;832        return _HandlePID(hObj, pObj, pState->x, pState->y, pState->Pressed);
000a66  7a20              LDRB     r0,[r4,#8]
000a68  9000              STR      r0,[sp,#0]
000a6a  4639              MOV      r1,r7
000a6c  4630              MOV      r0,r6
000a6e  e9d42300          LDRD     r2,r3,[r4,#0]
000a72  f7fffffe          BL       _HandlePID
                  |L1.2678|
;;;833      }
;;;834      return _HandlePID(hObj, pObj, -1, -1, -1); /* Moved out */
;;;835    }
000a76  bdf8              POP      {r3-r7,pc}
                  |L1.2680|
000a78  f04f30ff          MOV      r0,#0xffffffff        ;834
000a7c  4603              MOV      r3,r0                 ;834
000a7e  4602              MOV      r2,r0                 ;834
000a80  4639              MOV      r1,r7                 ;834
000a82  9000              STR      r0,[sp,#0]            ;834
000a84  4630              MOV      r0,r6                 ;834
000a86  f7fffffe          BL       _HandlePID
000a8a  e7f4              B        |L1.2678|
;;;836    
                          ENDP

                  _SetPaintColors PROC
;;;854    */
;;;855    static void _SetPaintColors(const MENU_Obj* pObj, const MENU_ITEM* pItem, int ItemIndex) {
000a8c  e92d41f0          PUSH     {r4-r8,lr}
000a90  4604              MOV      r4,r0
000a92  460e              MOV      r6,r1
000a94  4617              MOV      r7,r2
;;;856      char Selected;
;;;857      unsigned ColorIndex;
;;;858      Selected = (ItemIndex == pObj->Sel) ? 1 : 0;
000a96  6ee0              LDR      r0,[r4,#0x6c]
000a98  42b8              CMP      r0,r7
000a9a  d101              BNE      |L1.2720|
000a9c  2001              MOVS     r0,#1
000a9e  e000              B        |L1.2722|
                  |L1.2720|
000aa0  2000              MOVS     r0,#0
                  |L1.2722|
000aa2  4680              MOV      r8,r0
;;;859      if (pObj->IsSubmenuActive && Selected) {
000aa4  f8940060          LDRB     r0,[r4,#0x60]
000aa8  b120              CBZ      r0,|L1.2740|
000aaa  f1b80f00          CMP      r8,#0
000aae  d001              BEQ      |L1.2740|
;;;860        ColorIndex = MENU_CI_ACTIVE_SUBMENU;
000ab0  2504              MOVS     r5,#4
000ab2  e018              B        |L1.2790|
                  |L1.2740|
;;;861      } else if (pItem->Flags & MENU_IF_SEPARATOR) {
000ab4  7930              LDRB     r0,[r6,#4]
000ab6  f0000002          AND      r0,r0,#2
000aba  b108              CBZ      r0,|L1.2752|
;;;862        ColorIndex = MENU_CI_ENABLED;
000abc  2500              MOVS     r5,#0
000abe  e012              B        |L1.2790|
                  |L1.2752|
;;;863      } else {
;;;864        ColorIndex = (Selected) ? MENU_CI_SELECTED : MENU_CI_ENABLED;
000ac0  f1b80f00          CMP      r8,#0
000ac4  d001              BEQ      |L1.2762|
000ac6  2001              MOVS     r0,#1
000ac8  e000              B        |L1.2764|
                  |L1.2762|
000aca  2000              MOVS     r0,#0
                  |L1.2764|
000acc  4605              MOV      r5,r0
;;;865        if (pItem->Flags & MENU_IF_DISABLED) {
000ace  7930              LDRB     r0,[r6,#4]
000ad0  f0000001          AND      r0,r0,#1
000ad4  b138              CBZ      r0,|L1.2790|
;;;866          if (pObj->Flags & MENU_CF_HIDE_DISABLED_SEL) {
000ad6  f894005e          LDRB     r0,[r4,#0x5e]
000ada  f0000008          AND      r0,r0,#8
000ade  b108              CBZ      r0,|L1.2788|
;;;867            ColorIndex = MENU_CI_DISABLED;
000ae0  2502              MOVS     r5,#2
000ae2  e000              B        |L1.2790|
                  |L1.2788|
;;;868          } else {
;;;869            ColorIndex += MENU_CI_DISABLED;
000ae4  1cad              ADDS     r5,r5,#2
                  |L1.2790|
;;;870          }
;;;871        }
;;;872      }
;;;873      GUI_SetBkColor(pObj->Props.aBkColor[ColorIndex]);
000ae6  f104013c          ADD      r1,r4,#0x3c
000aea  f8510025          LDR      r0,[r1,r5,LSL #2]
000aee  f7fffffe          BL       GUI_SetBkColor
;;;874      GUI_SetColor(pObj->Props.aTextColor[ColorIndex]);
000af2  f1040128          ADD      r1,r4,#0x28
000af6  f8510025          LDR      r0,[r1,r5,LSL #2]
000afa  f7fffffe          BL       GUI_SetColor
;;;875    }
000afe  e8bd81f0          POP      {r4-r8,pc}
;;;876    
                          ENDP

                  _OnPaint PROC
;;;880    */
;;;881    static void _OnPaint(MENU_Handle hObj, MENU_Obj* pObj) {
000b02  e92d4ff3          PUSH     {r0,r1,r4-r11,lr}
000b06  b089              SUB      sp,sp,#0x24
000b08  460c              MOV      r4,r1
;;;882      GUI_RECT FillRect, TextRect;
;;;883      MENU_ITEM* pItem;
;;;884      unsigned TextWidth, NumItems, i;
;;;885      U8 BorderLeft   = pObj->Props.aBorder[MENU_BI_LEFT];
000b0a  f8949050          LDRB     r9,[r4,#0x50]
;;;886      U8 BorderTop    = pObj->Props.aBorder[MENU_BI_TOP];
000b0e  f894a052          LDRB     r10,[r4,#0x52]
;;;887      int FontHeight  = GUI_GetYDistOfFont(pObj->Props.pFont);
000b12  6d60              LDR      r0,[r4,#0x54]
000b14  f7fffffe          BL       GUI_GetYDistOfFont
000b18  9003              STR      r0,[sp,#0xc]
;;;888      int EffectSize  = _GetEffectSize(hObj, pObj);
000b1a  4621              MOV      r1,r4
000b1c  9809              LDR      r0,[sp,#0x24]
000b1e  f7fffffe          BL       _GetEffectSize
000b22  4607              MOV      r7,r0
;;;889      NumItems = MENU__GetNumItems(pObj);
000b24  4620              MOV      r0,r4
000b26  f7fffffe          BL       MENU__GetNumItems
000b2a  9004              STR      r0,[sp,#0x10]
;;;890      WM__GetClientRectWin(&pObj->Widget.Win, &FillRect);
000b2c  a907              ADD      r1,sp,#0x1c
000b2e  4620              MOV      r0,r4
000b30  f7fffffe          BL       WM__GetClientRectWin
;;;891      GUI__ReduceRect(&FillRect, &FillRect, EffectSize);
000b34  463a              MOV      r2,r7
000b36  a907              ADD      r1,sp,#0x1c
000b38  a807              ADD      r0,sp,#0x1c
000b3a  f7fffffe          BL       GUI__ReduceRect
;;;892      GUI_SetFont(pObj->Props.pFont);
000b3e  6d60              LDR      r0,[r4,#0x54]
000b40  f7fffffe          BL       GUI_SetFont
;;;893      if (pObj->Flags & MENU_SF_VERTICAL) {
000b44  f894005e          LDRB     r0,[r4,#0x5e]
000b48  f0000001          AND      r0,r0,#1
000b4c  2800              CMP      r0,#0
000b4e  d06a              BEQ      |L1.3110|
;;;894        int ItemHeight, xSize;
;;;895        xSize = _CalcMenuSizeX(hObj, pObj);
000b50  4621              MOV      r1,r4
000b52  9809              LDR      r0,[sp,#0x24]
000b54  f7fffffe          BL       _CalcMenuSizeX
000b58  9002              STR      r0,[sp,#8]
;;;896        FillRect.x1 = xSize - EffectSize - 1;
000b5a  9802              LDR      r0,[sp,#8]
000b5c  1bc0              SUBS     r0,r0,r7
000b5e  1e40              SUBS     r0,r0,#1
000b60  b200              SXTH     r0,r0
000b62  f8ad0020          STRH     r0,[sp,#0x20]
;;;897        TextRect.x0 = FillRect.x0 + BorderLeft;
000b66  f8bd001c          LDRH     r0,[sp,#0x1c]
000b6a  4448              ADD      r0,r0,r9
000b6c  b200              SXTH     r0,r0
000b6e  f8ad0014          STRH     r0,[sp,#0x14]
;;;898        for (i = 0; i < NumItems; i++) {
000b72  2600              MOVS     r6,#0
000b74  e053              B        |L1.3102|
                  |L1.2934|
;;;899          pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
000b76  4631              MOV      r1,r6
000b78  f1040058          ADD      r0,r4,#0x58
000b7c  f7fffffe          BL       GUI_ARRAY_GetpItem
000b80  4605              MOV      r5,r0
;;;900          ItemHeight = _GetItemHeight(hObj, pObj, i);
000b82  4632              MOV      r2,r6
000b84  4621              MOV      r1,r4
000b86  9809              LDR      r0,[sp,#0x24]
000b88  f7fffffe          BL       _GetItemHeight
000b8c  4683              MOV      r11,r0
;;;901          _SetPaintColors(pObj, pItem, i);
000b8e  4632              MOV      r2,r6
000b90  4629              MOV      r1,r5
000b92  4620              MOV      r0,r4
000b94  f7fffffe          BL       _SetPaintColors
;;;902          FillRect.y1 = FillRect.y0 + ItemHeight - 1;
000b98  f8bd001e          LDRH     r0,[sp,#0x1e]
000b9c  4458              ADD      r0,r0,r11
000b9e  1e40              SUBS     r0,r0,#1
000ba0  b200              SXTH     r0,r0
000ba2  f8ad0022          STRH     r0,[sp,#0x22]
;;;903          if (pItem->Flags & MENU_IF_SEPARATOR) {
000ba6  7928              LDRB     r0,[r5,#4]
000ba8  f0000002          AND      r0,r0,#2
000bac  b190              CBZ      r0,|L1.3028|
;;;904            GUI_ClearRectEx(&FillRect);
000bae  a807              ADD      r0,sp,#0x1c
000bb0  f7fffffe          BL       GUI_ClearRectEx
;;;905            GUI_SetColor(0x7C7C7C);
000bb4  48fe              LDR      r0,|L1.4016|
000bb6  f7fffffe          BL       GUI_SetColor
;;;906            GUI_DrawHLine(FillRect.y0 + BorderTop + 1, FillRect.x0 + 2, FillRect.x1 - 2);
000bba  f9bd3020          LDRSH    r3,[sp,#0x20]
000bbe  1e9a              SUBS     r2,r3,#2
000bc0  f9bd301c          LDRSH    r3,[sp,#0x1c]
000bc4  1c99              ADDS     r1,r3,#2
000bc6  f9bd301e          LDRSH    r3,[sp,#0x1e]
000bca  4453              ADD      r3,r3,r10
000bcc  1c58              ADDS     r0,r3,#1
000bce  f7fffffe          BL       GUI_DrawHLine
000bd2  e01d              B        |L1.3088|
                  |L1.3028|
;;;907          } else {
;;;908            TextWidth = pItem->TextWidth;
000bd4  f8d58008          LDR      r8,[r5,#8]
;;;909            TextRect.x1 = TextRect.x0 + TextWidth - 1;
000bd8  f8bd0014          LDRH     r0,[sp,#0x14]
000bdc  4440              ADD      r0,r0,r8
000bde  1e40              SUBS     r0,r0,#1
000be0  b200              SXTH     r0,r0
000be2  f8ad0018          STRH     r0,[sp,#0x18]
;;;910            TextRect.y0 = FillRect.y0 + BorderTop;
000be6  f8bd001e          LDRH     r0,[sp,#0x1e]
000bea  4450              ADD      r0,r0,r10
000bec  b200              SXTH     r0,r0
000bee  f8ad0016          STRH     r0,[sp,#0x16]
;;;911            TextRect.y1 = TextRect.y0 + FontHeight - 1;
000bf2  f8bd1016          LDRH     r1,[sp,#0x16]
000bf6  9803              LDR      r0,[sp,#0xc]
000bf8  4408              ADD      r0,r0,r1
000bfa  1e40              SUBS     r0,r0,#1
000bfc  b200              SXTH     r0,r0
000bfe  f8ad001a          STRH     r0,[sp,#0x1a]
;;;912            WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
000c02  ab05              ADD      r3,sp,#0x14
000c04  aa05              ADD      r2,sp,#0x14
000c06  a907              ADD      r1,sp,#0x1c
000c08  f105000c          ADD      r0,r5,#0xc
000c0c  f7fffffe          BL       WIDGET__FillStringInRect
                  |L1.3088|
;;;913          }
;;;914          FillRect.y0 += ItemHeight;
000c10  f8bd001e          LDRH     r0,[sp,#0x1e]
000c14  4458              ADD      r0,r0,r11
000c16  b200              SXTH     r0,r0
000c18  f8ad001e          STRH     r0,[sp,#0x1e]
000c1c  1c76              ADDS     r6,r6,#1              ;898
                  |L1.3102|
000c1e  9804              LDR      r0,[sp,#0x10]         ;898
000c20  4286              CMP      r6,r0                 ;898
000c22  d3a8              BCC      |L1.2934|
;;;915        }
;;;916      } else {
000c24  e06a              B        |L1.3324|
                  |L1.3110|
;;;917        int ItemWidth, ySize;
;;;918        ySize = _CalcMenuSizeY(hObj, pObj);
000c26  4621              MOV      r1,r4
000c28  9809              LDR      r0,[sp,#0x24]
000c2a  f7fffffe          BL       _CalcMenuSizeY
000c2e  9002              STR      r0,[sp,#8]
;;;919        FillRect.y1 = ySize - EffectSize - 1;
000c30  9802              LDR      r0,[sp,#8]
000c32  1bc0              SUBS     r0,r0,r7
000c34  1e40              SUBS     r0,r0,#1
000c36  b200              SXTH     r0,r0
000c38  f8ad0022          STRH     r0,[sp,#0x22]
;;;920        TextRect.y0 = FillRect.y0 + BorderTop;
000c3c  f8bd001e          LDRH     r0,[sp,#0x1e]
000c40  4450              ADD      r0,r0,r10
000c42  b200              SXTH     r0,r0
000c44  f8ad0016          STRH     r0,[sp,#0x16]
;;;921        TextRect.y1 = TextRect.y0 + FontHeight - 1;
000c48  f8bd1016          LDRH     r1,[sp,#0x16]
000c4c  9803              LDR      r0,[sp,#0xc]
000c4e  4408              ADD      r0,r0,r1
000c50  1e40              SUBS     r0,r0,#1
000c52  b200              SXTH     r0,r0
000c54  f8ad001a          STRH     r0,[sp,#0x1a]
;;;922        for (i = 0; i < NumItems; i++) {
000c58  2600              MOVS     r6,#0
000c5a  e04b              B        |L1.3316|
                  |L1.3164|
;;;923          pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
000c5c  4631              MOV      r1,r6
000c5e  f1040058          ADD      r0,r4,#0x58
000c62  f7fffffe          BL       GUI_ARRAY_GetpItem
000c66  4605              MOV      r5,r0
;;;924          ItemWidth = _GetItemWidth(hObj, pObj, i);
000c68  4632              MOV      r2,r6
000c6a  4621              MOV      r1,r4
000c6c  9809              LDR      r0,[sp,#0x24]
000c6e  f7fffffe          BL       _GetItemWidth
000c72  4683              MOV      r11,r0
;;;925          _SetPaintColors(pObj, pItem, i);
000c74  4632              MOV      r2,r6
000c76  4629              MOV      r1,r5
000c78  4620              MOV      r0,r4
000c7a  f7fffffe          BL       _SetPaintColors
;;;926          FillRect.x1 = FillRect.x0 + ItemWidth - 1;
000c7e  f8bd001c          LDRH     r0,[sp,#0x1c]
000c82  4458              ADD      r0,r0,r11
000c84  1e40              SUBS     r0,r0,#1
000c86  b200              SXTH     r0,r0
000c88  f8ad0020          STRH     r0,[sp,#0x20]
;;;927          if (pItem->Flags & MENU_IF_SEPARATOR) {
000c8c  7928              LDRB     r0,[r5,#4]
000c8e  f0000002          AND      r0,r0,#2
000c92  b190              CBZ      r0,|L1.3258|
;;;928            GUI_ClearRectEx(&FillRect);
000c94  a807              ADD      r0,sp,#0x1c
000c96  f7fffffe          BL       GUI_ClearRectEx
;;;929            GUI_SetColor(0x7C7C7C);
000c9a  48c5              LDR      r0,|L1.4016|
000c9c  f7fffffe          BL       GUI_SetColor
;;;930            GUI_DrawVLine(FillRect.x0 + BorderLeft + 1, FillRect.y0 + 2, FillRect.y1 - 2);
000ca0  f9bd3022          LDRSH    r3,[sp,#0x22]
000ca4  1e9a              SUBS     r2,r3,#2
000ca6  f9bd301e          LDRSH    r3,[sp,#0x1e]
000caa  1c99              ADDS     r1,r3,#2
000cac  f9bd301c          LDRSH    r3,[sp,#0x1c]
000cb0  444b              ADD      r3,r3,r9
000cb2  1c58              ADDS     r0,r3,#1
000cb4  f7fffffe          BL       GUI_DrawVLine
000cb8  e015              B        |L1.3302|
                  |L1.3258|
;;;931          } else {
;;;932            TextWidth = pItem->TextWidth;
000cba  f8d58008          LDR      r8,[r5,#8]
;;;933            TextRect.x0 = FillRect.x0 + BorderLeft;
000cbe  f8bd001c          LDRH     r0,[sp,#0x1c]
000cc2  4448              ADD      r0,r0,r9
000cc4  b200              SXTH     r0,r0
000cc6  f8ad0014          STRH     r0,[sp,#0x14]
;;;934            TextRect.x1 = TextRect.x0 + TextWidth - 1;
000cca  f8bd0014          LDRH     r0,[sp,#0x14]
000cce  4440              ADD      r0,r0,r8
000cd0  1e40              SUBS     r0,r0,#1
000cd2  b200              SXTH     r0,r0
000cd4  f8ad0018          STRH     r0,[sp,#0x18]
;;;935            WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
000cd8  ab05              ADD      r3,sp,#0x14
000cda  aa05              ADD      r2,sp,#0x14
000cdc  a907              ADD      r1,sp,#0x1c
000cde  f105000c          ADD      r0,r5,#0xc
000ce2  f7fffffe          BL       WIDGET__FillStringInRect
                  |L1.3302|
;;;936          }
;;;937          FillRect.x0 += ItemWidth;
000ce6  f8bd001c          LDRH     r0,[sp,#0x1c]
000cea  4458              ADD      r0,r0,r11
000cec  b200              SXTH     r0,r0
000cee  f8ad001c          STRH     r0,[sp,#0x1c]
000cf2  1c76              ADDS     r6,r6,#1              ;922
                  |L1.3316|
000cf4  9804              LDR      r0,[sp,#0x10]         ;922
000cf6  4286              CMP      r6,r0                 ;922
000cf8  d3b0              BCC      |L1.3164|
;;;938        }
;;;939      }
000cfa  bf00              NOP      
                  |L1.3324|
;;;940      if (pObj->Width || pObj->Height) {
000cfc  6e60              LDR      r0,[r4,#0x64]
000cfe  b908              CBNZ     r0,|L1.3332|
000d00  6ea0              LDR      r0,[r4,#0x68]
000d02  b300              CBZ      r0,|L1.3398|
                  |L1.3332|
;;;941        GUI_RECT r;
;;;942        WM__GetClientRectWin(&pObj->Widget.Win, &r);
000d04  a901              ADD      r1,sp,#4
000d06  4620              MOV      r0,r4
000d08  f7fffffe          BL       WM__GetClientRectWin
;;;943        GUI__ReduceRect(&r, &r, EffectSize);
000d0c  463a              MOV      r2,r7
000d0e  a901              ADD      r1,sp,#4
000d10  a801              ADD      r0,sp,#4
000d12  f7fffffe          BL       GUI__ReduceRect
;;;944        GUI_SetBkColor(pObj->Props.aBkColor[MENU_CI_ENABLED]);
000d16  6be0              LDR      r0,[r4,#0x3c]
000d18  f7fffffe          BL       GUI_SetBkColor
;;;945        GUI_ClearRect(FillRect.x1 + 1, EffectSize, r.x1, FillRect.y1);
000d1c  f9bd3022          LDRSH    r3,[sp,#0x22]
000d20  f9bd2008          LDRSH    r2,[sp,#8]
000d24  f9bd1020          LDRSH    r1,[sp,#0x20]
000d28  1c48              ADDS     r0,r1,#1
000d2a  4639              MOV      r1,r7
000d2c  f7fffffe          BL       GUI_ClearRect
;;;946        GUI_ClearRect(EffectSize, FillRect.y1 + 1, r.x1, r.y1);
000d30  f9bd300a          LDRSH    r3,[sp,#0xa]
000d34  f9bd2008          LDRSH    r2,[sp,#8]
000d38  f9bd0022          LDRSH    r0,[sp,#0x22]
000d3c  1c41              ADDS     r1,r0,#1
000d3e  4638              MOV      r0,r7
000d40  f7fffffe          BL       GUI_ClearRect
;;;947      }
000d44  bf00              NOP      
                  |L1.3398|
;;;948      /* Draw 3D effect (if configured) */
;;;949      if (_HasEffect(hObj, pObj)) {
000d46  4621              MOV      r1,r4
000d48  9809              LDR      r0,[sp,#0x24]
000d4a  f7fffffe          BL       _HasEffect
000d4e  b110              CBZ      r0,|L1.3414|
;;;950        pObj->Widget.pEffect->pfDrawUp();
000d50  6a21              LDR      r1,[r4,#0x20]
000d52  6808              LDR      r0,[r1,#0]
000d54  4780              BLX      r0
                  |L1.3414|
;;;951      }
;;;952    }
000d56  b00b              ADD      sp,sp,#0x2c
000d58  e8bd8ff0          POP      {r4-r11,pc}
;;;953    
                          ENDP

                  _MoveSel PROC
;;;962    */
;;;963    static void _MoveSel(MENU_Handle hObj, int Dir) {
000d5c  e92d5ff0          PUSH     {r4-r12,lr}
000d60  4683              MOV      r11,r0
000d62  4688              MOV      r8,r1
;;;964      MENU_Obj * pObj;
;;;965      int NewIndex, Index, NumItems, Cnt = 0;
000d64  2600              MOVS     r6,#0
;;;966      pObj = (MENU_Obj*) GUI_ALLOC_h2p(hObj);
000d66  4658              MOV      r0,r11
000d68  f7fffffe          BL       GUI_ALLOC_h2p
000d6c  4605              MOV      r5,r0
;;;967      Index = pObj->Sel;
000d6e  6eec              LDR      r4,[r5,#0x6c]
;;;968      NewIndex = -1;
000d70  f04f39ff          MOV      r9,#0xffffffff
;;;969      NumItems = pObj->ItemArray.NumItems;
000d74  f8b5a058          LDRH     r10,[r5,#0x58]
;;;970      do {
000d78  bf00              NOP      
                  |L1.3450|
;;;971        MENU_ITEM * pItem;
;;;972        Index += Dir;
000d7a  4444              ADD      r4,r4,r8
;;;973        if (Index >= NumItems) {
000d7c  4554              CMP      r4,r10
000d7e  db02              BLT      |L1.3462|
;;;974          Index = 0;
000d80  2400              MOVS     r4,#0
;;;975          Cnt++;
000d82  1c76              ADDS     r6,r6,#1
000d84  e004              B        |L1.3472|
                  |L1.3462|
;;;976        } else if (Index < 0) {
000d86  2c00              CMP      r4,#0
000d88  da02              BGE      |L1.3472|
;;;977          Index = NumItems - 1;
000d8a  f1aa0401          SUB      r4,r10,#1
;;;978          Cnt++;
000d8e  1c76              ADDS     r6,r6,#1
                  |L1.3472|
;;;979        }
;;;980        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000d90  4621              MOV      r1,r4
000d92  f1050058          ADD      r0,r5,#0x58
000d96  f7fffffe          BL       GUI_ARRAY_GetpItem
000d9a  4607              MOV      r7,r0
;;;981        if (!(pItem->Flags & MENU_IF_SEPARATOR)) {
000d9c  7938              LDRB     r0,[r7,#4]
000d9e  f0000002          AND      r0,r0,#2
000da2  b900              CBNZ     r0,|L1.3494|
;;;982          NewIndex = Index;
000da4  46a1              MOV      r9,r4
                  |L1.3494|
;;;983        }
;;;984      } while ((NewIndex < 0) && (Cnt < 2));
000da6  f1b90f00          CMP      r9,#0
000daa  da01              BGE      |L1.3504|
000dac  2e02              CMP      r6,#2
000dae  dbe4              BLT      |L1.3450|
                  |L1.3504|
;;;985      if (NewIndex >= 0) {
000db0  f1b90f00          CMP      r9,#0
000db4  db04              BLT      |L1.3520|
;;;986        _SetSelection(hObj, pObj, Index);
000db6  4622              MOV      r2,r4
000db8  4629              MOV      r1,r5
000dba  4658              MOV      r0,r11
000dbc  f7fffffe          BL       _SetSelection
                  |L1.3520|
;;;987      }
;;;988    }
000dc0  e8bd9ff0          POP      {r4-r12,pc}
;;;989    
                          ENDP

                  _OpenMenu PROC
;;;993    */
;;;994    static void _OpenMenu(MENU_Handle hObj, MENU_Obj * pObj, int Index, int SubSel) {
000dc4  e92d47f0          PUSH     {r4-r10,lr}
000dc8  4681              MOV      r9,r0
000dca  460c              MOV      r4,r1
000dcc  4690              MOV      r8,r2
000dce  461d              MOV      r5,r3
;;;995      MENU_ITEM * pItem;
;;;996      MENU_Obj  * pSubObj;
;;;997      pItem = (MENU_ITEM *)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000dd0  4641              MOV      r1,r8
000dd2  f1040058          ADD      r0,r4,#0x58
000dd6  f7fffffe          BL       GUI_ARRAY_GetpItem
000dda  4606              MOV      r6,r0
;;;998      pObj->Flags |= MENU_SF_ACTIVE;
000ddc  f8b4005e          LDRH     r0,[r4,#0x5e]
000de0  f0400040          ORR      r0,r0,#0x40
000de4  f8a4005e          STRH     r0,[r4,#0x5e]
;;;999      _OpenSubmenu(hObj, pObj, Index);
000de8  4642              MOV      r2,r8
000dea  4621              MOV      r1,r4
000dec  4648              MOV      r0,r9
000dee  f7fffffe          BL       _OpenSubmenu
;;;1000     pSubObj = (MENU_Obj *) GUI_ALLOC_h2p(pItem->hSubmenu);
000df2  f9b60000          LDRSH    r0,[r6,#0]
000df6  f7fffffe          BL       GUI_ALLOC_h2p
000dfa  4607              MOV      r7,r0
;;;1001     if (SubSel >= pSubObj->ItemArray.NumItems) {
000dfc  f8b70058          LDRH     r0,[r7,#0x58]
000e00  42a8              CMP      r0,r5
000e02  dc02              BGT      |L1.3594|
;;;1002       SubSel = pSubObj->ItemArray.NumItems - 1;
000e04  f8b70058          LDRH     r0,[r7,#0x58]
000e08  1e45              SUBS     r5,r0,#1
                  |L1.3594|
;;;1003     }
;;;1004     _SetSelection(pItem->hSubmenu, pSubObj, SubSel);
000e0a  f9b60000          LDRSH    r0,[r6,#0]
000e0e  462a              MOV      r2,r5
000e10  4639              MOV      r1,r7
000e12  f7fffffe          BL       _SetSelection
;;;1005     WM_SetFocus(pItem->hSubmenu);
000e16  f9b60000          LDRSH    r0,[r6,#0]
000e1a  f7fffffe          BL       WM_SetFocus
;;;1006     _SetSelection(hObj, pObj, Index);
000e1e  4642              MOV      r2,r8
000e20  4621              MOV      r1,r4
000e22  4648              MOV      r0,r9
000e24  f7fffffe          BL       _SetSelection
;;;1007   }
000e28  e8bd87f0          POP      {r4-r10,pc}
;;;1008   
                          ENDP

                  _OnKey PROC
;;;1012   */
;;;1013   static int _OnKey(MENU_Handle hObj, MENU_Obj * pObj, int Key) {
000e2c  e92d4ff0          PUSH     {r4-r11,lr}
000e30  b085              SUB      sp,sp,#0x14
000e32  4607              MOV      r7,r0
000e34  460d              MOV      r5,r1
000e36  4614              MOV      r4,r2
;;;1014     int KeyOpen, KeyBack, KeyNext, KeyPrev, Index, SubSel = 0;
000e38  2000              MOVS     r0,#0
000e3a  9003              STR      r0,[sp,#0xc]
;;;1015     MENU_ITEM * pItem;
;;;1016     MENU_Handle hObjTopLevel;
;;;1017     MENU_Obj * pObjTopLevel;
;;;1018     Index = pObj->Sel;
000e3c  6ee8              LDR      r0,[r5,#0x6c]
000e3e  9004              STR      r0,[sp,#0x10]
;;;1019     _GetTopLevelMenu(hObj, pObj, &hObjTopLevel, &pObjTopLevel, &SubSel);
000e40  a803              ADD      r0,sp,#0xc
000e42  ab01              ADD      r3,sp,#4
000e44  aa02              ADD      r2,sp,#8
000e46  4629              MOV      r1,r5
000e48  9000              STR      r0,[sp,#0]
000e4a  4638              MOV      r0,r7
000e4c  f7fffffe          BL       _GetTopLevelMenu
;;;1020     if (Index < 0) {
000e50  9804              LDR      r0,[sp,#0x10]
000e52  2800              CMP      r0,#0
000e54  da0e              BGE      |L1.3700|
;;;1021       if (Key != GUI_KEY_ESCAPE) {
000e56  2c1b              CMP      r4,#0x1b
000e58  d008              BEQ      |L1.3692|
;;;1022         _SetSelection(hObj, pObj, 0);
000e5a  2200              MOVS     r2,#0
000e5c  4629              MOV      r1,r5
000e5e  4638              MOV      r0,r7
000e60  f7fffffe          BL       _SetSelection
;;;1023         _SetCapture(hObj, pObj);
000e64  4629              MOV      r1,r5
000e66  4638              MOV      r0,r7
000e68  f7fffffe          BL       _SetCapture
                  |L1.3692|
;;;1024       }
;;;1025       return 0;
000e6c  2000              MOVS     r0,#0
                  |L1.3694|
;;;1026     }
;;;1027     if (pObj->Flags & MENU_CF_VERTICAL) {
;;;1028       KeyOpen = GUI_KEY_RIGHT;
;;;1029       KeyBack = GUI_KEY_LEFT;
;;;1030       KeyNext = GUI_KEY_DOWN;
;;;1031       KeyPrev = GUI_KEY_UP;
;;;1032     } else {
;;;1033       KeyOpen = GUI_KEY_DOWN;
;;;1034       KeyBack = 0;
;;;1035       KeyNext = GUI_KEY_RIGHT;
;;;1036       KeyPrev = GUI_KEY_LEFT;
;;;1037     }
;;;1038     pItem = (MENU_ITEM *)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
;;;1039     if (pItem->hSubmenu && ((Key == KeyOpen) || (Key == GUI_KEY_ENTER))) {
;;;1040       /*
;;;1041        *  If the current menu item is a submenu and <ENTER> or KeyOpen has been pressed, open the submenu
;;;1042        */
;;;1043       _OpenMenu(hObj, pObj, Index, 0);
;;;1044     } else if (!pItem->hSubmenu && (Key == GUI_KEY_ENTER)) {
;;;1045       /*
;;;1046        *  If the current menu item is not a submenu and <ENTER> has been pressed,
;;;1047        *  set the focus to the top level menu, close the submenus and send an MENU_ON_ITEMSELECT message to the owner
;;;1048        */
;;;1049       WM_SetFocus(hObjTopLevel);
;;;1050       _ActivateItem(hObj, pObj, Index);
;;;1051     } else if (((hObjTopLevel != hObj) && !(pObjTopLevel->Flags & MENU_CF_VERTICAL) && (Key == KeyOpen) && (!pItem->hSubmenu)) ||
;;;1052                ((hObjTopLevel != hObj) && !(pObjTopLevel->Flags & MENU_CF_VERTICAL) && (Key == KeyBack) && (hObjTopLevel == pObj->hOwner))) {
;;;1053       /*
;;;1054        *  If the current menu is not the top level menu and the top level menu is horizontal
;;;1055        *  and <GUI_KEY_RIGHT> or <GUI_KEY_LEFT> has been pressed close the current submenus,
;;;1056        *  move the selection of the top level menu to next/previous item and open it
;;;1057        */
;;;1058       pObj->Flags &= ~MENU_SF_ACTIVE;
;;;1059       /* Set focus to top level menu */
;;;1060       WM_SetFocus(hObjTopLevel);
;;;1061       /* Move selection of top level menu */
;;;1062       if (Key == KeyOpen) {
;;;1063         _MoveSel(hObjTopLevel, +1);
;;;1064       } else {
;;;1065         _MoveSel(hObjTopLevel, -1);
;;;1066       }
;;;1067       /* Open top level menu */
;;;1068       _OpenMenu(hObjTopLevel, pObjTopLevel, pObjTopLevel->Sel, (Key == KeyBack) ? SubSel : 0);
;;;1069     } else if ((hObjTopLevel != hObj) && 
;;;1070                ((Key == GUI_KEY_ESCAPE) || ((Key == KeyBack) && ((!(pObjTopLevel->Flags & MENU_CF_VERTICAL)) && (!pItem->hSubmenu) && (hObjTopLevel != pObj->hOwner)) || (pObjTopLevel->Flags & MENU_CF_VERTICAL)))) {
;;;1071       /*
;;;1072        *  If the current menu is not the top level menu and the top level menu is vertical and <GUI_KEY_LEFT> has been pressed
;;;1073        *  or the top level menu is vertical or horizontal and <GUI_KEY_ESCAPE> has been pressed,
;;;1074        *  close the current submenu
;;;1075        */
;;;1076       WM_SetFocus(pObj->hOwner);
;;;1077     } else if ((hObjTopLevel == hObj) && (Key == GUI_KEY_ESCAPE)) {
;;;1078       /*
;;;1079        *  If the current menu is the top level menu and <GUI_KEY_ESCAPE> has been pressed,
;;;1080        *  unselect the menu and release capture
;;;1081        */
;;;1082       _SetSelection(hObj, pObj, -1);
;;;1083       _ReleaseCapture(hObj, pObj);
;;;1084     } else if (Key == KeyNext) {
;;;1085       /*
;;;1086        *  If KeyNext has been pressed move the selection to the next menu item
;;;1087        */
;;;1088       _CloseSubmenu(hObj, pObj);
;;;1089       _MoveSel(hObj, +1);
;;;1090     } else if (Key == KeyPrev) {
;;;1091       /*
;;;1092        *  If KeyPrev has been pressed move the selection to the previous menu item
;;;1093        */
;;;1094       _CloseSubmenu(hObj, pObj);
;;;1095       _MoveSel(hObj, -1);
;;;1096     } else {
;;;1097       return 1;
;;;1098     }
;;;1099     return 0;
;;;1100   }
000e6e  b005              ADD      sp,sp,#0x14
000e70  e8bd8ff0          POP      {r4-r11,pc}
                  |L1.3700|
000e74  f895005e          LDRB     r0,[r5,#0x5e]         ;1027
000e78  f0000001          AND      r0,r0,#1              ;1027
000e7c  b140              CBZ      r0,|L1.3728|
000e7e  f04f0812          MOV      r8,#0x12              ;1028
000e82  f04f0910          MOV      r9,#0x10              ;1029
000e86  f04f0a13          MOV      r10,#0x13             ;1030
000e8a  f04f0b11          MOV      r11,#0x11             ;1031
000e8e  e007              B        |L1.3744|
                  |L1.3728|
000e90  f04f0813          MOV      r8,#0x13              ;1033
000e94  f04f0900          MOV      r9,#0                 ;1034
000e98  f04f0a12          MOV      r10,#0x12             ;1035
000e9c  f04f0b10          MOV      r11,#0x10             ;1036
                  |L1.3744|
000ea0  f1050058          ADD      r0,r5,#0x58           ;1038
000ea4  9904              LDR      r1,[sp,#0x10]         ;1038
000ea6  f7fffffe          BL       GUI_ARRAY_GetpItem
000eaa  4606              MOV      r6,r0                 ;1038
000eac  8830              LDRH     r0,[r6,#0]            ;1039
000eae  b150              CBZ      r0,|L1.3782|
000eb0  4544              CMP      r4,r8                 ;1039
000eb2  d001              BEQ      |L1.3768|
000eb4  2c0d              CMP      r4,#0xd               ;1039
000eb6  d106              BNE      |L1.3782|
                  |L1.3768|
000eb8  2300              MOVS     r3,#0                 ;1043
000eba  4629              MOV      r1,r5                 ;1043
000ebc  4638              MOV      r0,r7                 ;1043
000ebe  9a04              LDR      r2,[sp,#0x10]         ;1043
000ec0  f7fffffe          BL       _OpenMenu
000ec4  e0a0              B        |L1.4104|
                  |L1.3782|
000ec6  8830              LDRH     r0,[r6,#0]            ;1044
000ec8  b958              CBNZ     r0,|L1.3810|
000eca  2c0d              CMP      r4,#0xd               ;1044
000ecc  d109              BNE      |L1.3810|
000ece  f9bd0008          LDRSH    r0,[sp,#8]            ;1049
000ed2  f7fffffe          BL       WM_SetFocus
000ed6  4629              MOV      r1,r5                 ;1050
000ed8  4638              MOV      r0,r7                 ;1050
000eda  9a04              LDR      r2,[sp,#0x10]         ;1050
000edc  f7fffffe          BL       _ActivateItem
000ee0  e092              B        |L1.4104|
                  |L1.3810|
000ee2  f9bd0008          LDRSH    r0,[sp,#8]            ;1051
000ee6  42b8              CMP      r0,r7                 ;1051
000ee8  d009              BEQ      |L1.3838|
000eea  9801              LDR      r0,[sp,#4]            ;1051
000eec  f890005e          LDRB     r0,[r0,#0x5e]         ;1051
000ef0  f0000001          AND      r0,r0,#1              ;1051
000ef4  b918              CBNZ     r0,|L1.3838|
000ef6  4544              CMP      r4,r8                 ;1051
000ef8  d101              BNE      |L1.3838|
000efa  8830              LDRH     r0,[r6,#0]            ;1051
000efc  b188              CBZ      r0,|L1.3874|
                  |L1.3838|
000efe  f9bd0008          LDRSH    r0,[sp,#8]            ;1052
000f02  42b8              CMP      r0,r7                 ;1052
000f04  d033              BEQ      |L1.3950|
000f06  9801              LDR      r0,[sp,#4]            ;1052
000f08  f890005e          LDRB     r0,[r0,#0x5e]         ;1052
000f0c  f0000001          AND      r0,r0,#1              ;1052
000f10  bb68              CBNZ     r0,|L1.3950|
000f12  454c              CMP      r4,r9                 ;1052
000f14  d12b              BNE      |L1.3950|
000f16  f9b5005c          LDRSH    r0,[r5,#0x5c]         ;1052
000f1a  f9bd1008          LDRSH    r1,[sp,#8]            ;1052
000f1e  4288              CMP      r0,r1                 ;1052
000f20  d125              BNE      |L1.3950|
                  |L1.3874|
000f22  f8b5005e          LDRH     r0,[r5,#0x5e]         ;1058
000f26  f0200040          BIC      r0,r0,#0x40           ;1058
000f2a  f8a5005e          STRH     r0,[r5,#0x5e]         ;1058
000f2e  f9bd0008          LDRSH    r0,[sp,#8]            ;1060
000f32  f7fffffe          BL       WM_SetFocus
000f36  4544              CMP      r4,r8                 ;1062
000f38  d105              BNE      |L1.3910|
000f3a  2101              MOVS     r1,#1                 ;1063
000f3c  f9bd0008          LDRSH    r0,[sp,#8]            ;1063
000f40  f7fffffe          BL       _MoveSel
000f44  e005              B        |L1.3922|
                  |L1.3910|
000f46  f04f31ff          MOV      r1,#0xffffffff        ;1065
000f4a  f9bd0008          LDRSH    r0,[sp,#8]            ;1065
000f4e  f7fffffe          BL       _MoveSel
                  |L1.3922|
000f52  454c              CMP      r4,r9                 ;1068
000f54  d101              BNE      |L1.3930|
000f56  9803              LDR      r0,[sp,#0xc]          ;1068
000f58  e000              B        |L1.3932|
                  |L1.3930|
000f5a  2000              MOVS     r0,#0                 ;1068
                  |L1.3932|
000f5c  4603              MOV      r3,r0                 ;1068
000f5e  9801              LDR      r0,[sp,#4]            ;1068
000f60  4601              MOV      r1,r0                 ;1068
000f62  6ec2              LDR      r2,[r0,#0x6c]         ;1068
000f64  f9bd0008          LDRSH    r0,[sp,#8]            ;1068
000f68  f7fffffe          BL       _OpenMenu
000f6c  e04c              B        |L1.4104|
                  |L1.3950|
000f6e  f9bd0008          LDRSH    r0,[sp,#8]            ;1069
000f72  42b8              CMP      r0,r7                 ;1069
000f74  d01e              BEQ      |L1.4020|
000f76  2c1b              CMP      r4,#0x1b              ;1070
000f78  d015              BEQ      |L1.4006|
000f7a  454c              CMP      r4,r9                 ;1070
000f7c  d10d              BNE      |L1.3994|
000f7e  9801              LDR      r0,[sp,#4]            ;1070
000f80  f890005e          LDRB     r0,[r0,#0x5e]         ;1070
000f84  f0000001          AND      r0,r0,#1              ;1070
000f88  b938              CBNZ     r0,|L1.3994|
000f8a  8830              LDRH     r0,[r6,#0]            ;1070
000f8c  b928              CBNZ     r0,|L1.3994|
000f8e  f9b5005c          LDRSH    r0,[r5,#0x5c]         ;1070
000f92  f9bd1008          LDRSH    r1,[sp,#8]            ;1070
000f96  4288              CMP      r0,r1                 ;1070
000f98  d105              BNE      |L1.4006|
                  |L1.3994|
000f9a  9801              LDR      r0,[sp,#4]            ;1070
000f9c  f890005e          LDRB     r0,[r0,#0x5e]         ;1070
000fa0  f0000001          AND      r0,r0,#1              ;1070
000fa4  b130              CBZ      r0,|L1.4020|
                  |L1.4006|
000fa6  f9b5005c          LDRSH    r0,[r5,#0x5c]         ;1076
000faa  f7fffffe          BL       WM_SetFocus
000fae  e02b              B        |L1.4104|
                  |L1.4016|
                          DCD      0x007c7c7c
                  |L1.4020|
000fb4  f9bd0008          LDRSH    r0,[sp,#8]            ;1077
000fb8  42b8              CMP      r0,r7                 ;1077
000fba  d10c              BNE      |L1.4054|
000fbc  2c1b              CMP      r4,#0x1b              ;1077
000fbe  d10a              BNE      |L1.4054|
000fc0  f04f32ff          MOV      r2,#0xffffffff        ;1082
000fc4  4629              MOV      r1,r5                 ;1082
000fc6  4638              MOV      r0,r7                 ;1082
000fc8  f7fffffe          BL       _SetSelection
000fcc  4629              MOV      r1,r5                 ;1083
000fce  4638              MOV      r0,r7                 ;1083
000fd0  f7fffffe          BL       _ReleaseCapture
000fd4  e018              B        |L1.4104|
                  |L1.4054|
000fd6  4554              CMP      r4,r10                ;1084
000fd8  d108              BNE      |L1.4076|
000fda  4629              MOV      r1,r5                 ;1088
000fdc  4638              MOV      r0,r7                 ;1088
000fde  f7fffffe          BL       _CloseSubmenu
000fe2  2101              MOVS     r1,#1                 ;1089
000fe4  4638              MOV      r0,r7                 ;1089
000fe6  f7fffffe          BL       _MoveSel
000fea  e00d              B        |L1.4104|
                  |L1.4076|
000fec  455c              CMP      r4,r11                ;1090
000fee  d109              BNE      |L1.4100|
000ff0  4629              MOV      r1,r5                 ;1094
000ff2  4638              MOV      r0,r7                 ;1094
000ff4  f7fffffe          BL       _CloseSubmenu
000ff8  f04f31ff          MOV      r1,#0xffffffff        ;1095
000ffc  4638              MOV      r0,r7                 ;1095
000ffe  f7fffffe          BL       _MoveSel
001002  e001              B        |L1.4104|
                  |L1.4100|
001004  2001              MOVS     r0,#1                 ;1097
001006  e732              B        |L1.3694|
                  |L1.4104|
001008  2000              MOVS     r0,#0                 ;1099
00100a  e730              B        |L1.3694|
;;;1101   
                          ENDP

                  MENU_Callback PROC
;;;1134   */
;;;1135   void MENU_Callback(WM_MESSAGE* pMsg) {
00100c  e92d47f0          PUSH     {r4-r10,lr}
001010  4604              MOV      r4,r0
;;;1136     MENU_Handle hObj;
;;;1137     MENU_Obj* pObj;
;;;1138     int OldWidgetState, Result, HasFocus;
;;;1139     hObj = pMsg->hWin;
001012  f9b47004          LDRSH    r7,[r4,#4]
;;;1140     pObj = (MENU_Obj*) GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
001016  4638              MOV      r0,r7
001018  f7fffffe          BL       GUI_ALLOC_h2p
00101c  4605              MOV      r5,r0
;;;1141     OldWidgetState = pObj->Widget.State;
00101e  f8b58026          LDRH     r8,[r5,#0x26]
;;;1142     Result = 1;
001022  f04f0901          MOV      r9,#1
;;;1143     if (pMsg->MsgId != WM_PID_STATE_CHANGED) {
001026  6820              LDR      r0,[r4,#0]
001028  2811              CMP      r0,#0x11
00102a  d004              BEQ      |L1.4150|
;;;1144       /* Let widget handle the standard messages */
;;;1145       Result = WIDGET_HandleActive(hObj, pMsg);
00102c  4621              MOV      r1,r4
00102e  4638              MOV      r0,r7
001030  f7fffffe          BL       WIDGET_HandleActive
001034  4681              MOV      r9,r0
                  |L1.4150|
;;;1146     }
;;;1147     HasFocus = pObj->Widget.State & WIDGET_STATE_FOCUS;
001036  f8950026          LDRB     r0,[r5,#0x26]
00103a  f0000601          AND      r6,r0,#1
;;;1148     /* React on focus change */
;;;1149     if ((OldWidgetState & WIDGET_STATE_FOCUS) != HasFocus) {
00103e  f0080001          AND      r0,r8,#1
001042  42b0              CMP      r0,r6
001044  d021              BEQ      |L1.4234|
;;;1150       if (HasFocus) {
001046  b1b6              CBZ      r6,|L1.4214|
;;;1151         _CloseSubmenu(hObj, pObj);
001048  4629              MOV      r1,r5
00104a  4638              MOV      r0,r7
00104c  f7fffffe          BL       _CloseSubmenu
;;;1152         pObj->Flags &= ~MENU_SF_ACTIVE;
001050  f8b5005e          LDRH     r0,[r5,#0x5e]
001054  f0200040          BIC      r0,r0,#0x40
001058  f8a5005e          STRH     r0,[r5,#0x5e]
;;;1153         if (pObj->Sel <= 0) {
00105c  6ee8              LDR      r0,[r5,#0x6c]
00105e  2800              CMP      r0,#0
001060  dc13              BGT      |L1.4234|
;;;1154           _SetSelection(hObj, pObj, 0);
001062  2200              MOVS     r2,#0
001064  4629              MOV      r1,r5
001066  4638              MOV      r0,r7
001068  f7fffffe          BL       _SetSelection
;;;1155           _SetCapture(hObj, pObj);
00106c  4629              MOV      r1,r5
00106e  4638              MOV      r0,r7
001070  f7fffffe          BL       _SetCapture
001074  e009              B        |L1.4234|
                  |L1.4214|
;;;1156         }
;;;1157       } else {
;;;1158         _SetSelection(hObj, pObj, -1);
001076  f04f32ff          MOV      r2,#0xffffffff
00107a  4629              MOV      r1,r5
00107c  4638              MOV      r0,r7
00107e  f7fffffe          BL       _SetSelection
;;;1159         _ReleaseCapture(hObj, pObj);
001082  4629              MOV      r1,r5
001084  4638              MOV      r0,r7
001086  f7fffffe          BL       _ReleaseCapture
                  |L1.4234|
;;;1160       }
;;;1161     }
;;;1162     /* Return if message already has been processed */
;;;1163     if (!Result) {
00108a  f1b90f00          CMP      r9,#0
00108e  d101              BNE      |L1.4244|
                  |L1.4240|
;;;1164       return;
;;;1165     }
;;;1166     switch (pMsg->MsgId) {
;;;1167     case WM_MENU:
;;;1168       _OnMenu(hObj, pObj, pMsg);
;;;1169       return;     /* Message handled, do not call WM_DefaultProc() here. */
;;;1170     case WM_TOUCH:
;;;1171       if (_OnTouch(hObj, pObj, pMsg)) {
;;;1172         _ForwardPIDMsgToOwner(hObj, pObj, pMsg);
;;;1173       }
;;;1174       break;
;;;1175   #if (GUI_SUPPORT_MOUSE)
;;;1176     case WM_MOUSEOVER:
;;;1177       if (_OnMouseOver(hObj, pObj, pMsg)) {
;;;1178         _ForwardPIDMsgToOwner(hObj, pObj, pMsg);
;;;1179       }
;;;1180       break;
;;;1181   #endif
;;;1182     case WM_KEY:
;;;1183       if (((const WM_KEY_INFO*)(pMsg->Data.p))->PressedCnt > 0) {
;;;1184         if (!_OnKey(hObj, pObj, ((const WM_KEY_INFO*)(pMsg->Data.p))->Key)) {
;;;1185           return;
;;;1186         }
;;;1187       }
;;;1188       break;
;;;1189     case WM_PAINT:
;;;1190       _OnPaint(hObj, pObj);
;;;1191       break;
;;;1192     case WM_DELETE:
;;;1193       GUI_ARRAY_Delete(&pObj->ItemArray);
;;;1194       break;      /* No return here ... WM_DefaultProc needs to be called */
;;;1195     }
;;;1196     WM_DefaultProc(pMsg);
;;;1197   }
001090  e8bd87f0          POP      {r4-r10,pc}
                  |L1.4244|
001094  6820              LDR      r0,[r4,#0]            ;1166
001096  280e              CMP      r0,#0xe               ;1166
001098  d01b              BEQ      |L1.4306|
00109a  dc04              BGT      |L1.4262|
00109c  280b              CMP      r0,#0xb               ;1166
00109e  d02a              BEQ      |L1.4342|
0010a0  280c              CMP      r0,#0xc               ;1166
0010a2  d12d              BNE      |L1.4352|
0010a4  e009              B        |L1.4282|
                  |L1.4262|
0010a6  280f              CMP      r0,#0xf               ;1166
0010a8  d020              BEQ      |L1.4332|
0010aa  282c              CMP      r0,#0x2c              ;1166
0010ac  d128              BNE      |L1.4352|
0010ae  4622              MOV      r2,r4                 ;1168
0010b0  4629              MOV      r1,r5                 ;1168
0010b2  4638              MOV      r0,r7                 ;1168
0010b4  f7fffffe          BL       _OnMenu
0010b8  e7ea              B        |L1.4240|
                  |L1.4282|
0010ba  4622              MOV      r2,r4                 ;1171
0010bc  4629              MOV      r1,r5                 ;1171
0010be  4638              MOV      r0,r7                 ;1171
0010c0  f7fffffe          BL       _OnTouch
0010c4  b120              CBZ      r0,|L1.4304|
0010c6  4622              MOV      r2,r4                 ;1172
0010c8  4629              MOV      r1,r5                 ;1172
0010ca  4638              MOV      r0,r7                 ;1172
0010cc  f7fffffe          BL       _ForwardPIDMsgToOwner
                  |L1.4304|
0010d0  e016              B        |L1.4352|
                  |L1.4306|
0010d2  68a0              LDR      r0,[r4,#8]            ;1183
0010d4  6840              LDR      r0,[r0,#4]            ;1183
0010d6  2800              CMP      r0,#0                 ;1183
0010d8  dd07              BLE      |L1.4330|
0010da  68a0              LDR      r0,[r4,#8]            ;1184
0010dc  4629              MOV      r1,r5                 ;1184
0010de  6802              LDR      r2,[r0,#0]            ;1184
0010e0  4638              MOV      r0,r7                 ;1184
0010e2  f7fffffe          BL       _OnKey
0010e6  b900              CBNZ     r0,|L1.4330|
0010e8  e7d2              B        |L1.4240|
                  |L1.4330|
0010ea  e009              B        |L1.4352|
                  |L1.4332|
0010ec  4629              MOV      r1,r5                 ;1190
0010ee  4638              MOV      r0,r7                 ;1190
0010f0  f7fffffe          BL       _OnPaint
0010f4  e004              B        |L1.4352|
                  |L1.4342|
0010f6  f1050058          ADD      r0,r5,#0x58           ;1193
0010fa  f7fffffe          BL       GUI_ARRAY_Delete
0010fe  bf00              NOP                            ;1194
                  |L1.4352|
001100  bf00              NOP                            ;1174
001102  4620              MOV      r0,r4                 ;1196
001104  f7fffffe          BL       WM_DefaultProc
001108  bf00              NOP      
00110a  e7c1              B        |L1.4240|
;;;1198   
                          ENDP

                  MENU_CreateEx PROC
;;;1208   */
;;;1209   MENU_Handle MENU_CreateEx(int x0, int y0, int xSize, int ySize, WM_HWIN hParent, int WinFlags, int ExFlags, int Id) {
00110c  e92d5fff          PUSH     {r0-r12,lr}
001110  4681              MOV      r9,r0
001112  468a              MOV      r10,r1
001114  4616              MOV      r6,r2
001116  461f              MOV      r7,r3
001118  f8ddb038          LDR      r11,[sp,#0x38]
00111c  9d10              LDR      r5,[sp,#0x40]
;;;1210     MENU_Handle hObj;
;;;1211     /* Create the window */
;;;1212     WM_LOCK();
;;;1213     hObj = WM_CreateWindowAsChild(x0, y0, xSize, ySize, hParent, WM_CF_SHOW | WM_CF_STAYONTOP | WinFlags, &MENU_Callback,
00111e  2150              MOVS     r1,#0x50
001120  f2af1217          ADR      r2,MENU_Callback + 1
001124  980f              LDR      r0,[sp,#0x3c]
001126  b280              UXTH     r0,r0
001128  f040000a          ORR      r0,r0,#0xa
00112c  463b              MOV      r3,r7
00112e  e9cdb000          STRD     r11,r0,[sp,#0]
001132  e9cd2102          STRD     r2,r1,[sp,#8]
001136  4632              MOV      r2,r6
001138  4651              MOV      r1,r10
00113a  4648              MOV      r0,r9
00113c  f7fffffe          BL       WM_CreateWindowAsChild
001140  4680              MOV      r8,r0
;;;1214                                   sizeof(MENU_Obj) - sizeof(WM_Obj));
;;;1215     if (hObj) {
001142  f1b80f00          CMP      r8,#0
001146  d032              BEQ      |L1.4526|
;;;1216       MENU_Obj* pObj;
;;;1217       pObj = (MENU_Obj*)GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
001148  4640              MOV      r0,r8
00114a  f7fffffe          BL       GUI_ALLOC_h2p
00114e  4604              MOV      r4,r0
;;;1218        /* Init sub-classes */
;;;1219       GUI_ARRAY_CREATE(&pObj->ItemArray);
;;;1220       /* init widget specific variables */
;;;1221       WIDGET__Init(&pObj->Widget, Id, WIDGET_STATE_FOCUSSABLE);
001150  2210              MOVS     r2,#0x10
001152  4620              MOV      r0,r4
001154  9911              LDR      r1,[sp,#0x44]
001156  f7fffffe          BL       WIDGET__Init
;;;1222       /* init member variables */
;;;1223       MENU_INIT_ID(pObj);
;;;1224       if (ExFlags & MENU_SF_OPEN_ON_POINTEROVER) {
00115a  f0050002          AND      r0,r5,#2
00115e  b110              CBZ      r0,|L1.4454|
;;;1225         ExFlags |= MENU_SF_ACTIVE;
001160  f0450540          ORR      r5,r5,#0x40
001164  e001              B        |L1.4458|
                  |L1.4454|
;;;1226       } else {
;;;1227         ExFlags &= ~(MENU_SF_ACTIVE);
001166  f0250540          BIC      r5,r5,#0x40
                  |L1.4458|
;;;1228       }
;;;1229       pObj->Props           = MENU__DefaultProps;
00116a  2230              MOVS     r2,#0x30
00116c  4967              LDR      r1,|L1.4876|
00116e  f1040028          ADD      r0,r4,#0x28
001172  f7fffffe          BL       __aeabi_memcpy4
;;;1230       pObj->Flags           = ExFlags;
001176  f8a4505e          STRH     r5,[r4,#0x5e]
;;;1231       pObj->Width           = ((xSize > 0) ? xSize : 0);
00117a  2e00              CMP      r6,#0
00117c  dd01              BLE      |L1.4482|
00117e  4630              MOV      r0,r6
001180  e000              B        |L1.4484|
                  |L1.4482|
001182  2000              MOVS     r0,#0
                  |L1.4484|
001184  6660              STR      r0,[r4,#0x64]
;;;1232       pObj->Height          = ((ySize > 0) ? ySize : 0);
001186  2f00              CMP      r7,#0
001188  dd01              BLE      |L1.4494|
00118a  4638              MOV      r0,r7
00118c  e000              B        |L1.4496|
                  |L1.4494|
00118e  2000              MOVS     r0,#0
                  |L1.4496|
001190  66a0              STR      r0,[r4,#0x68]
;;;1233       pObj->Sel             = -1;
001192  f04f30ff          MOV      r0,#0xffffffff
001196  66e0              STR      r0,[r4,#0x6c]
;;;1234       pObj->hOwner          = 0;
001198  2000              MOVS     r0,#0
00119a  f8a4005c          STRH     r0,[r4,#0x5c]
;;;1235       pObj->IsSubmenuActive = 0;
00119e  f8840060          STRB     r0,[r4,#0x60]
;;;1236       WIDGET_SetEffect(hObj, MENU__pDefaultEffect);
0011a2  485b              LDR      r0,|L1.4880|
0011a4  6801              LDR      r1,[r0,#0]  ; MENU__pDefaultEffect
0011a6  4640              MOV      r0,r8
0011a8  f7fffffe          BL       WIDGET_SetEffect
;;;1237     } else {
0011ac  bf00              NOP      
                  |L1.4526|
;;;1238       GUI_DEBUG_ERROROUT_IF(hObj==0, "MENU_CreateEx failed")
;;;1239     }
;;;1240     WM_UNLOCK();
;;;1241     return hObj;
0011ae  4640              MOV      r0,r8
;;;1242   }
0011b0  b004              ADD      sp,sp,#0x10
0011b2  e8bd9ff0          POP      {r4-r12,pc}
;;;1243   
                          ENDP

                  MENU__RecalcTextWidthOfItems PROC
;;;1271   */
;;;1272   void MENU__RecalcTextWidthOfItems(MENU_Obj* pObj) {
0011b6  e92d41f0          PUSH     {r4-r8,lr}
0011ba  4604              MOV      r4,r0
;;;1273     const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;1274     MENU_ITEM* pItem;
;;;1275     unsigned i, NumItems;
;;;1276     NumItems = MENU__GetNumItems(pObj);
0011bc  4620              MOV      r0,r4
0011be  f7fffffe          BL       MENU__GetNumItems
0011c2  4680              MOV      r8,r0
;;;1277     pOldFont  = GUI_SetFont(pObj->Props.pFont);
0011c4  6d60              LDR      r0,[r4,#0x54]
0011c6  f7fffffe          BL       GUI_SetFont
0011ca  4607              MOV      r7,r0
;;;1278     for (i = 0; i < NumItems; i++) {
0011cc  2600              MOVS     r6,#0
0011ce  e00b              B        |L1.4584|
                  |L1.4560|
;;;1279       pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
0011d0  4631              MOV      r1,r6
0011d2  f1040058          ADD      r0,r4,#0x58
0011d6  f7fffffe          BL       GUI_ARRAY_GetpItem
0011da  4605              MOV      r5,r0
;;;1280       pItem->TextWidth = GUI_GetStringDistX(pItem->acText);
0011dc  f105000c          ADD      r0,r5,#0xc
0011e0  f7fffffe          BL       GUI_GetStringDistX
0011e4  60a8              STR      r0,[r5,#8]
0011e6  1c76              ADDS     r6,r6,#1              ;1278
                  |L1.4584|
0011e8  4546              CMP      r6,r8                 ;1278
0011ea  d3f1              BCC      |L1.4560|
;;;1281     }
;;;1282     GUI_SetFont(pOldFont);
0011ec  4638              MOV      r0,r7
0011ee  f7fffffe          BL       GUI_SetFont
;;;1283   }
0011f2  e8bd81f0          POP      {r4-r8,pc}
;;;1284   
                          ENDP

                  MENU__SetItem PROC
;;;1300   */
;;;1301   char MENU__SetItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index, const MENU_ITEM_DATA* pItemData) {
0011f6  e92d47ff          PUSH     {r0-r10,lr}
0011fa  4607              MOV      r7,r0
0011fc  460d              MOV      r5,r1
0011fe  4690              MOV      r8,r2
001200  461c              MOV      r4,r3
;;;1302     MENU_ITEM Item = {0};
001202  2000              MOVS     r0,#0
001204  9000              STR      r0,[sp,#0]
001206  9001              STR      r0,[sp,#4]
001208  9002              STR      r0,[sp,#8]
00120a  9003              STR      r0,[sp,#0xc]
;;;1303     const char* pText;
;;;1304     pText = pItemData->pText;
00120c  6826              LDR      r6,[r4,#0]
;;;1305     if (!pText) {
00120e  b906              CBNZ     r6,|L1.4626|
;;;1306       pText = "";
001210  a640              ADR      r6,|L1.4884|
                  |L1.4626|
;;;1307     }
;;;1308     Item.Id        = pItemData->Id;
001212  88a0              LDRH     r0,[r4,#4]
001214  f8ad0002          STRH     r0,[sp,#2]
;;;1309     Item.Flags     = pItemData->Flags;
001218  88e0              LDRH     r0,[r4,#6]
00121a  f8ad0004          STRH     r0,[sp,#4]
;;;1310     Item.hSubmenu  = pItemData->hSubmenu;
00121e  8920              LDRH     r0,[r4,#8]
001220  f8ad0000          STRH     r0,[sp,#0]
;;;1311     Item.TextWidth = _CalcTextWidth(pObj, pText);
001224  4631              MOV      r1,r6
001226  4628              MOV      r0,r5
001228  f7fffffe          BL       _CalcTextWidth
00122c  9002              STR      r0,[sp,#8]
;;;1312     if (Item.Flags & MENU_IF_SEPARATOR) {
00122e  f8bd0004          LDRH     r0,[sp,#4]
001232  f0000002          AND      r0,r0,#2
001236  b110              CBZ      r0,|L1.4670|
;;;1313       Item.hSubmenu = 0;   /* Ensures that no separator is a submenu */
001238  2000              MOVS     r0,#0
00123a  f8ad0000          STRH     r0,[sp,#0]
                  |L1.4670|
;;;1314     }
;;;1315     if (GUI_ARRAY_SetItem(&pObj->ItemArray, Index, &Item, sizeof(MENU_ITEM) + strlen(pText)) != 0) {
00123e  4630              MOV      r0,r6
001240  f7fffffe          BL       strlen
001244  f1000910          ADD      r9,r0,#0x10
001248  464b              MOV      r3,r9
00124a  466a              MOV      r2,sp
00124c  4641              MOV      r1,r8
00124e  f1050058          ADD      r0,r5,#0x58
001252  f7fffffe          BL       GUI_ARRAY_SetItem
001256  b1b8              CBZ      r0,|L1.4744|
;;;1316       MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
001258  4641              MOV      r1,r8
00125a  f1050058          ADD      r0,r5,#0x58
00125e  f7fffffe          BL       GUI_ARRAY_GetpItem
001262  4681              MOV      r9,r0
;;;1317       strcpy(pItem->acText, pText);
001264  4631              MOV      r1,r6
001266  f109000c          ADD      r0,r9,#0xc
00126a  f7fffffe          BL       strcpy
;;;1318       MENU_SetOwner(Item.hSubmenu, hObj);
00126e  f9bd0000          LDRSH    r0,[sp,#0]
001272  4639              MOV      r1,r7
001274  f7fffffe          BL       MENU_SetOwner
;;;1319       WM_DetachWindow(Item.hSubmenu);   /* Ensures all submenus are initially closed */
001278  f9bd0000          LDRSH    r0,[sp,#0]
00127c  f7fffffe          BL       WM_DetachWindow
;;;1320       return 1;
001280  2001              MOVS     r0,#1
                  |L1.4738|
;;;1321     }
;;;1322     return 0;
;;;1323   }
001282  b004              ADD      sp,sp,#0x10
001284  e8bd87f0          POP      {r4-r10,pc}
                  |L1.4744|
001288  2000              MOVS     r0,#0                 ;1322
00128a  e7fa              B        |L1.4738|
;;;1324   
                          ENDP

                  MENU__SetItemFlags PROC
;;;1328   */
;;;1329   void MENU__SetItemFlags(MENU_Obj* pObj, unsigned Index, U16 Mask, U16 Flags) {
00128c  e92d41f0          PUSH     {r4-r8,lr}
001290  4605              MOV      r5,r0
001292  4688              MOV      r8,r1
001294  4616              MOV      r6,r2
001296  461f              MOV      r7,r3
;;;1330     MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
001298  4641              MOV      r1,r8
00129a  f1050058          ADD      r0,r5,#0x58
00129e  f7fffffe          BL       GUI_ARRAY_GetpItem
0012a2  4604              MOV      r4,r0
;;;1331     pItem->Flags &= ~Mask;
0012a4  88a0              LDRH     r0,[r4,#4]
0012a6  43b0              BICS     r0,r0,r6
0012a8  80a0              STRH     r0,[r4,#4]
;;;1332     pItem->Flags |= Flags;
0012aa  88a0              LDRH     r0,[r4,#4]
0012ac  4338              ORRS     r0,r0,r7
0012ae  80a0              STRH     r0,[r4,#4]
;;;1333   }
0012b0  e8bd81f0          POP      {r4-r8,pc}
;;;1334   
                          ENDP

                  MENU_AddItem PROC
;;;1366   */
;;;1367   void MENU_AddItem(MENU_Handle hObj, const MENU_ITEM_DATA* pItemData) {
0012b4  e92d41f0          PUSH     {r4-r8,lr}
0012b8  4606              MOV      r6,r0
0012ba  460d              MOV      r5,r1
;;;1368     if (hObj && pItemData) {
0012bc  b31e              CBZ      r6,|L1.4870|
0012be  b315              CBZ      r5,|L1.4870|
;;;1369       MENU_Obj* pObj;
;;;1370       WM_LOCK();
;;;1371       pObj = MENU_H2P(hObj);
0012c0  4630              MOV      r0,r6
0012c2  f7fffffe          BL       GUI_ALLOC_h2p
0012c6  4604              MOV      r4,r0
;;;1372       if (pObj) {
0012c8  b1e4              CBZ      r4,|L1.4868|
;;;1373         if (GUI_ARRAY_AddItem(&pObj->ItemArray, NULL, 0) == 0) {
0012ca  2200              MOVS     r2,#0
0012cc  4611              MOV      r1,r2
0012ce  f1040058          ADD      r0,r4,#0x58
0012d2  f7fffffe          BL       GUI_ARRAY_AddItem
0012d6  b9a8              CBNZ     r0,|L1.4868|
;;;1374           unsigned Index;
;;;1375           Index = MENU__GetNumItems(pObj) - 1;
0012d8  4620              MOV      r0,r4
0012da  f7fffffe          BL       MENU__GetNumItems
0012de  1e47              SUBS     r7,r0,#1
;;;1376           if (MENU__SetItem(hObj, pObj, Index, pItemData) == 0) {
0012e0  462b              MOV      r3,r5
0012e2  463a              MOV      r2,r7
0012e4  4621              MOV      r1,r4
0012e6  4630              MOV      r0,r6
0012e8  f7fffffe          BL       MENU__SetItem
0012ec  b928              CBNZ     r0,|L1.4858|
;;;1377             GUI_ARRAY_DeleteItem(&pObj->ItemArray, Index);
0012ee  4639              MOV      r1,r7
0012f0  f1040058          ADD      r0,r4,#0x58
0012f4  f7fffffe          BL       GUI_ARRAY_DeleteItem
0012f8  e003              B        |L1.4866|
                  |L1.4858|
;;;1378           } else {
;;;1379             MENU__ResizeMenu(hObj, pObj);
0012fa  4621              MOV      r1,r4
0012fc  4630              MOV      r0,r6
0012fe  f7fffffe          BL       MENU__ResizeMenu
                  |L1.4866|
;;;1380           }
;;;1381         }
001302  bf00              NOP      
                  |L1.4868|
;;;1382       }
;;;1383       WM_UNLOCK();
;;;1384     }
001304  bf00              NOP      
                  |L1.4870|
;;;1385   }
001306  e8bd81f0          POP      {r4-r8,pc}
;;;1386   
                          ENDP

00130a  0000              DCW      0x0000
                  |L1.4876|
                          DCD      MENU__DefaultProps
                  |L1.4880|
                          DCD      MENU__pDefaultEffect
                  |L1.4884|
001314  00                DCB      0
001315  00                DCB      0
001316  00                DCB      0
001317  00                DCB      0

                          AREA ||.data||, DATA, ALIGN=2

                  MENU__DefaultProps
                          DCD      0x00000000
                          DCD      0x00ffffff
                          DCD      0x007c7c7c
                          DCD      0x00d3d3d3
                          DCD      0x00ffffff
                          DCD      0x00d3d3d3
                          DCD      0x00980000
                          DCD      0x00d3d3d3
                          DCD      0x00980000
                          DCD      0x007c7c7c
000028  04040202          DCB      0x04,0x04,0x02,0x02
                          DCD      GUI_Font13_1
                  MENU__pDefaultEffect
                          DCD      WIDGET_Effect_3D1L
