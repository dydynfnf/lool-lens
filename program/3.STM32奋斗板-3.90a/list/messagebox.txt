; generated by ARM C/C++ Compiler, 4.1 [Build 791]
; commandline ArmCC [--list --debug -c --asm --interleave -o.\obj\messagebox.o --asm_dir=.\list\ --list_dir=.\list\ --depend=.\obj\messagebox.d --cpu=Cortex-M3 --apcs=interwork -O0 -I.\FWlib\inc -I.\user -I.\CM3 -I.\TFT -I.\GUI\AntiAlias -I.\GUI\Config -I.\GUI\ConvertColor -I.\GUI\ConvertMono -I.\GUI\Core -I.\GUI\Font -I.\GUI\GUI_X -I.\GUI\JPEG -I.\GUI\LCDDriver -I.\GUI\MemDev -I.\GUI\MultiLayer -I.\GUI\Widget -I.\GUI\WM -Id:\Keil\ARM\CMSIS\Include -Id:\Keil\ARM\INC\ST\STM32F10x -DUSE_STDPERIPH_DRIVER -DSTM32F10X_HD -DUSE_STM3210B_EVAL --omf_browse=.\obj\messagebox.crf GUI\Widget\MESSAGEBOX.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  _MESSAGEBOX_cbCallback PROC
;;;65     */
;;;66     static void _MESSAGEBOX_cbCallback(WM_MESSAGE * pMsg) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4604              MOV      r4,r0
;;;67       WM_HWIN hWin = pMsg->hWin;
000006  f9b45004          LDRSH    r5,[r4,#4]
;;;68       switch (pMsg->MsgId) {
00000a  6820              LDR      r0,[r4,#0]
00000c  280e              CMP      r0,#0xe
00000e  d00a              BEQ      |L1.38|
000010  281e              CMP      r0,#0x1e
000012  d002              BEQ      |L1.26|
000014  2826              CMP      r0,#0x26
000016  d12c              BNE      |L1.114|
000018  e01a              B        |L1.80|
                  |L1.26|
;;;69         case WM_INIT_DIALOG:
;;;70           FRAMEWIN_SetClientColor(hWin, MESSAGEBOX_BKCOLOR);
00001a  f06f417f          MVN      r1,#0xff000000
00001e  4628              MOV      r0,r5
000020  f7fffffe          BL       FRAMEWIN_SetClientColor
;;;71           break;
000024  e029              B        |L1.122|
                  |L1.38|
;;;72         case WM_KEY:
;;;73           {
;;;74             int Key = ((const WM_KEY_INFO*)(pMsg->Data.p))->Key;
000026  68a0              LDR      r0,[r4,#8]
000028  6806              LDR      r6,[r0,#0]
;;;75             if (((const WM_KEY_INFO*)(pMsg->Data.p))->PressedCnt) {
00002a  68a0              LDR      r0,[r4,#8]
00002c  6840              LDR      r0,[r0,#4]
00002e  b170              CBZ      r0,|L1.78|
;;;76               switch (Key) {
000030  2e0d              CMP      r6,#0xd
000032  d006              BEQ      |L1.66|
000034  2e1b              CMP      r6,#0x1b
000036  d109              BNE      |L1.76|
;;;77               case GUI_KEY_ESCAPE:
;;;78                 GUI_EndDialog(hWin, 1);             /* End dialog with return value 1 if <ESC> is pressed */
000038  2101              MOVS     r1,#1
00003a  4628              MOV      r0,r5
00003c  f7fffffe          BL       GUI_EndDialog
;;;79                 break;
000040  e004              B        |L1.76|
                  |L1.66|
;;;80               case GUI_KEY_ENTER:
;;;81                 GUI_EndDialog(hWin, 0);             /* End dialog with return value 0 if <ENTER> is pressed */
000042  2100              MOVS     r1,#0
000044  4628              MOV      r0,r5
000046  f7fffffe          BL       GUI_EndDialog
;;;82                 break;
00004a  bf00              NOP      
                  |L1.76|
00004c  bf00              NOP                            ;79
                  |L1.78|
;;;83               }
;;;84             }
;;;85           }
;;;86           break;
00004e  e014              B        |L1.122|
                  |L1.80|
;;;87         case WM_NOTIFY_PARENT:
;;;88           {
;;;89             int NCode = pMsg->Data.v;             /* Get notification code */
000050  68a6              LDR      r6,[r4,#8]
;;;90             int Id    = WM_GetId(pMsg->hWinSrc);  /* Get control ID */
000052  f9b40006          LDRSH    r0,[r4,#6]
000056  f7fffffe          BL       WM_GetId
00005a  4607              MOV      r7,r0
;;;91             switch (NCode) {
00005c  2e02              CMP      r6,#2
00005e  d106              BNE      |L1.110|
;;;92               case WM_NOTIFICATION_RELEASED:      /* React only if released */
;;;93                 if (Id == GUI_ID_OK) {
000060  2f01              CMP      r7,#1
000062  d103              BNE      |L1.108|
;;;94                   GUI_EndDialog(hWin, 0);         /* End dialog with return value 0 if OK */
000064  2100              MOVS     r1,#0
000066  4628              MOV      r0,r5
000068  f7fffffe          BL       GUI_EndDialog
                  |L1.108|
;;;95                 }
;;;96                 break;
00006c  bf00              NOP      
                  |L1.110|
00006e  bf00              NOP      
;;;97             }
;;;98           }
;;;99           break;
000070  e003              B        |L1.122|
                  |L1.114|
;;;100        default:
;;;101          WM_DefaultProc(pMsg);
000072  4620              MOV      r0,r4
000074  f7fffffe          BL       WM_DefaultProc
000078  bf00              NOP                            ;68
                  |L1.122|
00007a  bf00              NOP                            ;71
;;;102      }
;;;103    }
00007c  e8bd81f0          POP      {r4-r8,pc}
;;;104    
                          ENDP

                  MESSAGEBOX_Create PROC
;;;114    */
;;;115    WM_HWIN MESSAGEBOX_Create(const char * sMessage, const char * sCaption, int Flags) {
000080  e92d4ff7          PUSH     {r0-r2,r4-r11,lr}
000084  b09a              SUB      sp,sp,#0x68
000086  4681              MOV      r9,r0
000088  468a              MOV      r10,r1
;;;116      GUI_WIDGET_CREATE_INFO _aDialogCreate[3];                                     /* 0: FrameWin, 1: Text, 2: Button */
;;;117      int BorderSize = FRAMEWIN_GetDefaultBorderSize();                             /* Default border size of frame window */
00008a  f7fffffe          BL       FRAMEWIN_GetDefaultBorderSize
00008e  4604              MOV      r4,r0
;;;118      int xSizeFrame = MESSAGEBOX_XSIZEOK + 2 * BorderSize + MESSAGEBOX_BORDER * 2; /* XSize of frame window */
000090  ea4f0044          LSL      r0,r4,#1
000094  f100053a          ADD      r5,r0,#0x3a
;;;119      int ySizeFrame;                                                               /* YSize of frame window */
;;;120      int x0, y0;                                                                   /* Position of frame window */
;;;121      int xSizeMessage;                                                             /* Length in pixels of message */
;;;122      int xSizeCaption;                                                             /* Length in pixels of caption */
;;;123      int ySizeCaption;                                                             /* YSize of caption */
;;;124      int ySizeMessage;                                                             /* YSize of message */
;;;125      GUI_RECT Rect;
;;;126      const GUI_FONT GUI_UNI_PTR * pOldFont;
;;;127      /* Zeroinit variables */
;;;128      memset(_aDialogCreate, 0, sizeof(_aDialogCreate));
000098  f04f0148          MOV      r1,#0x48
00009c  a808              ADD      r0,sp,#0x20
00009e  f7fffffe          BL       __aeabi_memclr4
;;;129      /* Get dimension of message */
;;;130      pOldFont = GUI_SetFont(TEXT_GetDefaultFont());
0000a2  f7fffffe          BL       TEXT_GetDefaultFont
0000a6  9001              STR      r0,[sp,#4]
0000a8  f7fffffe          BL       GUI_SetFont
0000ac  9002              STR      r0,[sp,#8]
;;;131      GUI_GetTextExtend(&Rect, sMessage, 255);
0000ae  22ff              MOVS     r2,#0xff
0000b0  4649              MOV      r1,r9
0000b2  a803              ADD      r0,sp,#0xc
0000b4  f7fffffe          BL       GUI_GetTextExtend
;;;132      xSizeMessage = Rect.x1 - Rect.x0 + MESSAGEBOX_BORDER * 2;
0000b8  f9bd0010          LDRSH    r0,[sp,#0x10]
0000bc  f9bd100c          LDRSH    r1,[sp,#0xc]
0000c0  eba00001          SUB      r0,r0,r1
0000c4  f1000708          ADD      r7,r0,#8
;;;133      ySizeMessage = Rect.y1 - Rect.y0 + 1;
0000c8  f9bd0012          LDRSH    r0,[sp,#0x12]
0000cc  f9bd100e          LDRSH    r1,[sp,#0xe]
0000d0  eba00001          SUB      r0,r0,r1
0000d4  f1000b01          ADD      r11,r0,#1
;;;134      if (xSizeFrame < (xSizeMessage + 4 + MESSAGEBOX_BORDER * 2)) {
0000d8  f107000c          ADD      r0,r7,#0xc
0000dc  4285              CMP      r5,r0
0000de  da00              BGE      |L1.226|
;;;135        xSizeFrame = xSizeMessage + 4 + MESSAGEBOX_BORDER * 2;
0000e0  4605              MOV      r5,r0
                  |L1.226|
;;;136      }
;;;137      ySizeCaption = GUI_GetYSizeOfFont(FRAMEWIN_GetDefaultFont());
0000e2  f7fffffe          BL       FRAMEWIN_GetDefaultFont
0000e6  9001              STR      r0,[sp,#4]
0000e8  f7fffffe          BL       GUI_GetYSizeOfFont
0000ec  9005              STR      r0,[sp,#0x14]
;;;138      ySizeFrame = ySizeMessage +            /* size of message */
0000ee  f10b0114          ADD      r1,r11,#0x14
0000f2  9805              LDR      r0,[sp,#0x14]
0000f4  4408              ADD      r0,r0,r1
0000f6  f100000c          ADD      r0,r0,#0xc
0000fa  eb000044          ADD      r0,r0,r4,LSL #1
0000fe  f1000601          ADD      r6,r0,#1
;;;139                   MESSAGEBOX_YSIZEOK +      /* size of button */
;;;140                   ySizeCaption +            /* caption size */
;;;141                   MESSAGEBOX_BORDER * 3 +   /* inner border - text, text - button, button - bottom */
;;;142                   BorderSize * 2 +          /* top & bottom border */
;;;143                   1;                        /* inner border */
;;;144      /* Get xsize of caption */
;;;145      xSizeCaption = GUI_GetStringDistX(sCaption);
000102  4650              MOV      r0,r10
000104  f7fffffe          BL       GUI_GetStringDistX
000108  4680              MOV      r8,r0
;;;146      if (xSizeFrame < xSizeCaption + BorderSize * 2) {
00010a  eb080044          ADD      r0,r8,r4,LSL #1
00010e  42a8              CMP      r0,r5
000110  dd01              BLE      |L1.278|
;;;147        xSizeFrame = xSizeCaption + BorderSize * 2;
000112  eb080544          ADD      r5,r8,r4,LSL #1
                  |L1.278|
;;;148      }
;;;149      /* Check maximum */
;;;150      if (xSizeFrame > LCD_GET_XSIZE()) {
000116  f7fffffe          BL       LCD_GetXSize
00011a  42a8              CMP      r0,r5
00011c  da02              BGE      |L1.292|
;;;151        xSizeFrame = LCD_GET_XSIZE();
00011e  f7fffffe          BL       LCD_GetXSize
000122  4605              MOV      r5,r0
                  |L1.292|
;;;152      }
;;;153      if (ySizeFrame > LCD_GET_YSIZE()) {
000124  f7fffffe          BL       LCD_GetYSize
000128  42b0              CMP      r0,r6
00012a  da02              BGE      |L1.306|
;;;154        ySizeFrame = LCD_GET_YSIZE();
00012c  f7fffffe          BL       LCD_GetYSize
000130  4606              MOV      r6,r0
                  |L1.306|
;;;155      }
;;;156      /* Calculate position of framewin */
;;;157      x0 = (LCD_GET_XSIZE() - xSizeFrame) / 2;
000132  f7fffffe          BL       LCD_GetXSize
000136  eba00005          SUB      r0,r0,r5
00013a  9001              STR      r0,[sp,#4]
00013c  eb0070d0          ADD      r0,r0,r0,LSR #31
000140  ea4f0060          ASR      r0,r0,#1
000144  9007              STR      r0,[sp,#0x1c]
;;;158      y0 = (LCD_GET_YSIZE() - ySizeFrame) / 2;
000146  f7fffffe          BL       LCD_GetYSize
00014a  eba00006          SUB      r0,r0,r6
00014e  9001              STR      r0,[sp,#4]
000150  eb0070d0          ADD      r0,r0,r0,LSR #31
000154  ea4f0060          ASR      r0,r0,#1
000158  9006              STR      r0,[sp,#0x18]
;;;159      /* restore modified Context */
;;;160      GUI_SetFont(pOldFont);
00015a  9802              LDR      r0,[sp,#8]
00015c  f7fffffe          BL       GUI_SetFont
;;;161      /* Fill frame win resource */
;;;162      _aDialogCreate[0].pfCreateIndirect = FRAMEWIN_CreateIndirect;
000160  4838              LDR      r0,|L1.580|
000162  9008              STR      r0,[sp,#0x20]
;;;163      _aDialogCreate[0].pName            = sCaption;
000164  f8cda024          STR      r10,[sp,#0x24]
;;;164      _aDialogCreate[0].x0               = x0;
000168  9807              LDR      r0,[sp,#0x1c]
00016a  b200              SXTH     r0,r0
00016c  f8ad002a          STRH     r0,[sp,#0x2a]
;;;165      _aDialogCreate[0].y0               = y0;
000170  9806              LDR      r0,[sp,#0x18]
000172  b200              SXTH     r0,r0
000174  f8ad002c          STRH     r0,[sp,#0x2c]
;;;166      _aDialogCreate[0].xSize            = xSizeFrame;
000178  b228              SXTH     r0,r5
00017a  f8ad002e          STRH     r0,[sp,#0x2e]
;;;167      _aDialogCreate[0].ySize            = ySizeFrame;
00017e  b230              SXTH     r0,r6
000180  f8ad0030          STRH     r0,[sp,#0x30]
;;;168      if (Flags & GUI_MESSAGEBOX_CF_MOVEABLE) {
000184  981c              LDR      r0,[sp,#0x70]
000186  f0100f10          TST      r0,#0x10
00018a  d003              BEQ      |L1.404|
;;;169        _aDialogCreate[0].Flags          = FRAMEWIN_CF_MOVEABLE;
00018c  f04f0010          MOV      r0,#0x10
000190  f8ad0032          STRH     r0,[sp,#0x32]
                  |L1.404|
;;;170      }
;;;171      /* Fill text resource */
;;;172      _aDialogCreate[1].pfCreateIndirect = TEXT_CreateIndirect;
000194  482c              LDR      r0,|L1.584|
000196  900e              STR      r0,[sp,#0x38]
;;;173      _aDialogCreate[1].pName            = sMessage;
000198  f8cd903c          STR      r9,[sp,#0x3c]
;;;174      _aDialogCreate[1].x0               = (xSizeFrame - xSizeMessage - BorderSize * 2) / 2;
00019c  eba50107          SUB      r1,r5,r7
0001a0  eba10044          SUB      r0,r1,r4,LSL #1
0001a4  eb0071d0          ADD      r1,r0,r0,LSR #31
0001a8  ea4f0161          ASR      r1,r1,#1
0001ac  b20a              SXTH     r2,r1
0001ae  a908              ADD      r1,sp,#0x20
0001b0  844a              STRH     r2,[r1,#0x22]
;;;175      _aDialogCreate[1].y0               = MESSAGEBOX_BORDER;
0001b2  f04f0104          MOV      r1,#4
0001b6  a808              ADD      r0,sp,#0x20
0001b8  8481              STRH     r1,[r0,#0x24]
;;;176      _aDialogCreate[1].xSize            = xSizeMessage;
0001ba  b239              SXTH     r1,r7
0001bc  84c1              STRH     r1,[r0,#0x26]
;;;177      _aDialogCreate[1].ySize            = ySizeMessage;
0001be  fa0ff18b          SXTH     r1,r11
0001c2  8501              STRH     r1,[r0,#0x28]
;;;178      _aDialogCreate[1].Para             = GUI_TA_TOP | GUI_TA_HCENTER;
0001c4  f04f0102          MOV      r1,#2
0001c8  9113              STR      r1,[sp,#0x4c]
;;;179      /* Fill button resource */
;;;180      _aDialogCreate[2].pfCreateIndirect = BUTTON_CreateIndirect;
0001ca  4820              LDR      r0,|L1.588|
0001cc  9014              STR      r0,[sp,#0x50]
;;;181      _aDialogCreate[2].pName            = "OK";
0001ce  a120              ADR      r1,|L1.592|
0001d0  9115              STR      r1,[sp,#0x54]
;;;182      _aDialogCreate[2].Id               = GUI_ID_OK;
0001d2  f04f0101          MOV      r1,#1
0001d6  a808              ADD      r0,sp,#0x20
0001d8  8701              STRH     r1,[r0,#0x38]
;;;183      _aDialogCreate[2].x0               = (xSizeFrame - MESSAGEBOX_XSIZEOK - BorderSize * 2) / 2;
0001da  f1a50132          SUB      r1,r5,#0x32
0001de  eba10044          SUB      r0,r1,r4,LSL #1
0001e2  eb0071d0          ADD      r1,r0,r0,LSR #31
0001e6  ea4f0161          ASR      r1,r1,#1
0001ea  b20a              SXTH     r2,r1
0001ec  a908              ADD      r1,sp,#0x20
0001ee  874a              STRH     r2,[r1,#0x3a]
;;;184      _aDialogCreate[2].y0               = MESSAGEBOX_BORDER * 2 + ySizeMessage;
0001f0  f10b0008          ADD      r0,r11,#8
0001f4  b201              SXTH     r1,r0
0001f6  a808              ADD      r0,sp,#0x20
0001f8  8781              STRH     r1,[r0,#0x3c]
;;;185      _aDialogCreate[2].xSize            = MESSAGEBOX_XSIZEOK;
0001fa  f04f0132          MOV      r1,#0x32
0001fe  87c1              STRH     r1,[r0,#0x3e]
;;;186      _aDialogCreate[2].ySize            = MESSAGEBOX_YSIZEOK;
000200  f04f0114          MOV      r1,#0x14
000204  f8ad1060          STRH     r1,[sp,#0x60]
;;;187      /* Create dialog */
;;;188      return GUI_CreateDialogBox(_aDialogCreate, GUI_COUNTOF(_aDialogCreate), _MESSAGEBOX_cbCallback, 0, 0, 0);
000208  f04f0000          MOV      r0,#0
00020c  9000              STR      r0,[sp,#0]
00020e  4603              MOV      r3,r0
000210  4a10              LDR      r2,|L1.596|
000212  f04f0103          MOV      r1,#3
000216  9001              STR      r0,[sp,#4]
000218  a808              ADD      r0,sp,#0x20
00021a  f7fffffe          BL       GUI_CreateDialogBox
;;;189    }
00021e  b01d              ADD      sp,sp,#0x74
000220  e8bd8ff0          POP      {r4-r11,pc}
;;;190    
                          ENDP

                  GUI_MessageBox PROC
;;;194    */
;;;195    int GUI_MessageBox(const char * sMessage, const char * sCaption, int Flags) {
000224  e92d41f0          PUSH     {r4-r8,lr}
000228  4604              MOV      r4,r0
00022a  460d              MOV      r5,r1
00022c  4616              MOV      r6,r2
;;;196      WM_HWIN hWin;
;;;197      hWin = MESSAGEBOX_Create(sMessage, sCaption, Flags);
00022e  4632              MOV      r2,r6
000230  4629              MOV      r1,r5
000232  4620              MOV      r0,r4
000234  f7fffffe          BL       MESSAGEBOX_Create
000238  4607              MOV      r7,r0
;;;198      /* Exec dialog */
;;;199      return GUI_ExecCreatedDialog(hWin);
00023a  4638              MOV      r0,r7
00023c  f7fffffe          BL       GUI_ExecCreatedDialog
;;;200    }
000240  e8bd81f0          POP      {r4-r8,pc}
;;;201    
                          ENDP

                  |L1.580|
                          DCD      FRAMEWIN_CreateIndirect
                  |L1.584|
                          DCD      TEXT_CreateIndirect
                  |L1.588|
                          DCD      BUTTON_CreateIndirect
                  |L1.592|
000250  4f4b00            DCB      "OK",0
000253  00                DCB      0
                  |L1.596|
                          DCD      _MESSAGEBOX_cbCallback
